(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}})();function Z(){(location.hostname==="localhost"||location.hostname==="127.0.0.1")&&(document.title+=" (DEV)")}const O="UmlkZVNhZmUyMDI1IQ==",M="rident_auth",G=30*24*60*60*1e3;function R(){const e=localStorage.getItem(M);if(!e)return!1;try{const{password:r,expires:s}=JSON.parse(e);return r===O&&Date.now()<s}catch{return!1}}function U(){const e=Date.now()+G;localStorage.setItem(M,JSON.stringify({password:O,expires:e}))}function V(){if(!R()){if(prompt("Enter password to view the map:")!==atob(O))throw alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>",new Error("Unauthorized");U()}}const x={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:100.5},C=[[x.minLat,x.minLon],[x.maxLat,x.maxLon]],N={satellite:"s",terrain:"p"},W=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${N.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],attribution:"&copy; Google Satellite",maxNativeZoom:18}),Y=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${N.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],attribution:"&copy; Google Terrain",maxNativeZoom:18,opacity:.5}),F=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:19}),H=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17}),K=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17}),j=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"],attribution:"&copy; OpenStreetMap contributors"}),J=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxNativeZoom:19}),X=L.tileLayer("./tiles/{z}/{x}/{y}.png?ts=1751622559850.6987",{tileSize:256,opacity:1,minNativeZoom:10,maxNativeZoom:13,attribution:"Ride NT",zIndex:3,className:"overlay"}),q=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],attribution:"&copy; Google Street View",maxNativeZoom:13,maxZoom:20,opacity:.7,zIndex:1,className:"overlay"}),Q=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10,opacity:.7})}}),ee=L.tileLayer("https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png",{transparent:!0,maxNativeZoom:18,zIndex:2,className:"overlay"}),S={"Google Terrain":Y,"OSM Standard":j,"World Topo Map":J,"Google Satellite":W,"ESRI Firefly":F,"ESRI Clarity":H,"ESRI Wayback":K},T={"Ride NT":X,"OpenStreetMap traces":ee,"Google Street View":q,Mapillary:Q},k="rident_map_view",z="rident_base_layer",_="rident_overlays";function te(){document.getElementById("map").style.display="block";const e=oe();ne(e);const r=L.control.layers(S,T,{collapsed:!0,autoZIndex:!1}).addTo(e),s=ae(e,S,T);return re(e,S,T),{map:e,baseLayers:S,overlays:T,currentBaseLayer:s,overlaysControl:r}}function oe(){const e=L.map("map",{minZoom:9,maxBounds:L.latLngBounds(C)});return e.attributionControl.setPrefix(""),e}function ne(e){const r=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(r){const o=+r[1],t=+r[2],n=+r[3];e.setView([t,n],o);return}const s=localStorage.getItem(k);if(s)try{const{center:o,zoom:t}=JSON.parse(s);e.setView(o,t);return}catch{}e.setView([18.79,98.98],10)}function ae(e,r,s){let o;const t=localStorage.getItem(z);t&&r[t]?(r[t].addTo(e),o=r[t]):(r["Google Terrain"].addTo(e),o=r["Google Terrain"]);const n=localStorage.getItem(_);let c=[];try{c=n?JSON.parse(n):[]}catch{}if(!c.length)s["Ride NT"].addTo(e);else for(const[p,d]of Object.entries(s))c.includes(p)&&d.addTo(e);return o}function re(e,r,s){e.on("baselayerchange",o=>{var n;const t=(n=Object.entries(r).find(([c,p])=>p===o.layer))==null?void 0:n[0];t&&localStorage.setItem(z,t)}),e.on("overlayadd overlayremove",()=>{const o=Object.entries(s).filter(([t,n])=>e.hasLayer(n)).map(([t])=>t);localStorage.setItem(_,JSON.stringify(o))}),e.on("moveend zoomend",()=>{const o=e.getCenter(),t=e.getZoom(),n=`#${t}/${o.lat.toFixed(6)}/${o.lng.toFixed(6)}`;location.hash=n,localStorage.setItem(k,JSON.stringify({center:o,zoom:t}))})}function se(e){const r=L.control({position:"bottomright"});r.onAdd=function(){const s=L.DomUtil.create("div","info legend");s.style.background="rgba(255, 255, 255, 0.9)",s.style.padding="8px",s.style.borderRadius="5px",s.style.fontSize="14px",s.style.color="#333",s.style.lineHeight="1.4",s.style.width="200px",s.style.position="relative",s.style.transition="all 0.3s ease";const o=1;function t(h){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${h.replace("OPACITY",o)};
				vertical-align:middle;
			"></span>`}const n="rgba(51, 102, 255, 1)",c="rgba(160,160,160,1)",p="rideNT-legend-visible";let d=localStorage.getItem(p)!=="false";const i=document.createElement("div");i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.cursor="pointer";const u=document.createElement("span");u.textContent="RideNT Legend";const g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttribute("width","20"),g.setAttribute("height","20"),g.setAttribute("viewBox","0 0 24 24"),g.style.transition="transform 0.2s ease",g.innerHTML='<path fill="#333" d="M7 10l5 5 5-5z"/>',i.appendChild(u),i.appendChild(g);const m=document.createElement("div");m.id="legend-content",m.innerHTML=`
			${t(n)} Paved<br>
			${t("rgba(0,140,60,OPACITY)")} Fast dirt <span class="caption">&gt; 30km/h</span> <br>
			${t("rgba(255,179,0,OPACITY)")} Moderate dirt <span class="caption">15–30 km/h</span><br>
			${t("rgba(255,40,40,OPACITY)")} Slow / Technical <span class="caption">7–15 km/h</span><br>
			${t("rgba(128,0,128,OPACITY)")} Very technical <span class="caption">&lt; 7 km/h</span><br>
			${t(c)} Potential trail<br>
			<br>
			<span class="caption">Speeds are approximate, calculated from GPX trails in dry conditions, with climate season and rider speed factors considered, but accuracy is not guaranteed.</span>
		`;const v=()=>{m.style.display=d?"block":"none",u.style.fontWeight=d?"bold":"normal",i.style.marginBottom=d?"6px":"0px",g.innerHTML=d?'<path fill="#333" d="M7 10l5 5 5-5z"/>':'<path fill="#333" d="M7 14l5-5 5 5z"/>',localStorage.setItem(p,d)};return i.onclick=()=>{d=!d,v()},v(),s.appendChild(i),s.appendChild(m),s},r.addTo(e)}function ie(e,r,s){const o=document.getElementById("context-menu");function t(p,d){const i=document.createElement("div");i.innerText=p,i.style.padding="4px 8px",i.style.cursor="pointer",i.onmouseenter=()=>i.style.background="#eee",i.onmouseleave=()=>i.style.background="",i.onmousedown=()=>{d(),o.style.display="none"},o.appendChild(i)}function n(){const p=document.createElement("hr");p.style.margin="0",o.appendChild(p)}e.on("contextmenu",function(p){const d=p.latlng.lat.toFixed(6),i=p.latlng.lng.toFixed(6),u=e.getZoom();o.innerHTML="",t("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/edit?editor=id&lat=${d}&lon=${i}&zoom=${e.getZoom()}`,"_blank")}),n(),t("Open in Google Maps",()=>{const g=s===r["Google Satellite"],m=new URLSearchParams({api:1,map_action:"map",basemap:g?"satellite":"terrain",center:[d,i].join(","),zoom:u});window.open(`https://www.google.com/maps/@?${unescape(m)}`,"_blank")}),t("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${d},${i}`,"_blank")}),t("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${d},${i},${u}z?sport=mtb`,"_blank")}),t("Open in Mapillary",()=>{const g=new URLSearchParams({lat:d,lng:i,z:u});window.open(`https://www.mapillary.com/app/?${unescape(g)}`,"_blank")}),n(),t("Copy Coordinates",()=>{navigator.clipboard.writeText(`${d}, ${i}`).then(()=>{alert("Coordinates copied to clipboard.")})}),o.style.left=p.originalEvent.pageX+"px",o.style.top=p.originalEvent.pageY+"px",o.style.display="block"});const c=()=>o.style.display="none";e.on("mousedown",c),document.addEventListener("mousedown",c)}function le(e,r,s={}){const o=e.getContainer(),t=L.latLngBounds(C);["dragenter","dragover","dragleave","drop"].forEach(n=>{o.addEventListener(n,c=>c.preventDefault(),!1)}),o.addEventListener("drop",n=>{if(n.preventDefault(),!!n.dataTransfer.files.length)for(const c of n.dataTransfer.files){if(!c.name.toLowerCase().endsWith(".gpx"))continue;const p=new FileReader;p.onload=d=>{const i=d.target.result,u=new L.GPX(i,{async:!0,polyline_options:{color:"magenta",weight:3},gpx_options:{joinTrackSegments:!1},markers:{startIcon:null,endIcon:null}});u.on("loaded",()=>{const g=u.getBounds();if(t.intersects(g)){u.addTo(e);const m=c.name.replace(/\.gpx$/i,"");s[m]=u,r.addOverlay(u,m),e.fitBounds(g)}else alert(`GPX file "${c.name}" is outside the allowed bounds and will not be displayed.`)})},p.readAsText(c)}})}function ce(e,r,s,o){function t(){document.getElementById("map").classList.toggle("hide-overlays")}document.addEventListener("keydown",n=>{const c=document.activeElement;c&&(c.tagName==="INPUT"||c.tagName==="TEXTAREA"||c.isContentEditable)||(n.key.toLowerCase()==="o"?t():n.key==="Delete"&&(localStorage.clear(),location.reload()))})}function de(e){const r=[];let s=null,o=!1;const t=a=>{const l=a.getZoom();return{color:"yellow",weight:Math.max(4,25-(18-l)*2),opacity:.5}},n=L.control({position:"bottomleft"});n.onAdd=function(){const a=L.DomUtil.create("div","leaflet-bar leaflet-control"),l=L.DomUtil.create("a","",a);l.href="#",l.innerHTML="🖊️",l.title="Toggle highlighter",l.style.padding="6px 10px",l.style.fontSize="20px";const y=L.DomUtil.create("a","",a);y.href="#",y.innerHTML="🧽",y.title="Clear highlights",y.style.padding="6px 10px",y.style.fontSize="20px",l.onclick=f=>{f.preventDefault(),o=!o,b()},y.onclick=f=>{f.preventDefault(),r.forEach(E=>e.removeLayer(E)),r.length=0,h()};function b(){o?(l.style.background="#ff0",l.style.color="black"):(l.style.background="white",l.style.color="")}return a},n.addTo(e);function c(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function p(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function d(a){return a.latlng?a.latlng:a.touches&&a.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(a.touches[0])):null}function i(a){if(!o)return;const l=d(a);l&&(c(),s=L.polyline([l],t(e)).addTo(e),r.push(s),a.preventDefault&&a.preventDefault())}function u(a){if(!o||!s)return;const l=d(a);l&&(s.addLatLng(l),a.preventDefault&&a.preventDefault())}function g(a){o&&s&&(s=null,h(),p()),a.preventDefault&&a.preventDefault()}e.on("mousedown",i),e.on("mousemove",u),e.on("mouseup",g);const m=e.getContainer();m.addEventListener("touchstart",i,{passive:!1}),m.addEventListener("touchmove",u,{passive:!1}),m.addEventListener("touchend",g,{passive:!1}),e.on("zoomend",()=>{r.forEach(a=>a.setStyle(t(e)))}),window.addEventListener("keydown",a=>{if(a.key.toLowerCase()==="d"&&(o=!o,v()),(a.ctrlKey||a.metaKey)&&a.key.toLowerCase()==="z"&&r.length>0){const l=r.pop();e.removeLayer(l),h()}});function v(){const a=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');a&&(o?(a.style.background="#ff0",a.style.color="black"):(a.style.background="white",a.style.color=""))}function h(){if(!r.length){I(null);return}const a=r.map(l=>polyline.encode(l.getLatLngs().map(y=>[y.lat,y.lng]))).join(";");I(a)}function I(a){const l=new URLSearchParams(window.location.search);a?l.set("data",a):l.delete("data");const y=window.location.pathname+(l.toString()?"?"+l.toString():"")+window.location.hash;window.history.replaceState(null,"",y)}function P(){const l=new URLSearchParams(window.location.search).get("data");if(!l)return;l.split(";").forEach(b=>{try{const f=polyline.decode(b).map(([A,B])=>L.latLng(A,B)),E=L.polyline(f,t(e)).addTo(e);r.push(E)}catch{console.warn("Invalid polyline segment:",b)}})}P()}Z();V();const{map:w,baseLayers:D,overlays:$,currentBaseLayer:pe,overlaysControl:ge}=te();se(w);ie(w,D,pe);ce(w,$,D["Google Satellite"]);de(w);le(w,ge,$);
