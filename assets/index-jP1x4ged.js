(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=i(t);fetch(t.href,o)}})();function G(){(location.hostname==="localhost"||location.hostname==="127.0.0.1")&&(document.title+=" (DEV)")}const C="UmlkZVNhZmUyMDI1IQ==",I="rident_auth",R=30*24*60*60*1e3;function V(){const e=localStorage.getItem(I);if(!e)return!1;try{const{password:r,expires:i}=JSON.parse(e);return r===C&&Date.now()<i}catch{return!1}}function U(){const e=Date.now()+R;localStorage.setItem(I,JSON.stringify({password:C,expires:e}))}function k(){V()||(prompt("Enter password to view the map:")!==atob(C)&&(alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>"),U()),document.body.classList.remove("locked")}const S={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:100.5},M=[[S.minLat,S.minLon],[S.maxLat,S.maxLon]],N={satellite:"s",terrain:"p"},W=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${N.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],attribution:"&copy; Google Satellite",maxNativeZoom:18}),Y=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${N.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],attribution:"&copy; Google Terrain",maxNativeZoom:18,opacity:.5}),F=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:19}),H=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17}),K=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17}),j=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"],attribution:"&copy; OpenStreetMap contributors"}),J=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxNativeZoom:19}),X=L.tileLayer("./tiles/{z}/{x}/{y}.png?ts=1751811890505.5383",{tileSize:256,opacity:1,minNativeZoom:10,maxNativeZoom:13,attribution:"Ride NT",zIndex:3,className:"overlay"}),q=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],attribution:"&copy; Google Street View",maxNativeZoom:13,maxZoom:20,opacity:.7,zIndex:1,className:"overlay"}),Q=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10,opacity:.7})}}),ee=L.tileLayer("https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png",{transparent:!0,maxNativeZoom:18,zIndex:2,className:"overlay"}),T={"Google Terrain":Y,"OSM Standard":j,"World Topo Map":J,"Google Satellite":W,"ESRI Firefly":F,"ESRI Clarity":H,"ESRI Wayback":K},E={"Ride NT":X,"OpenStreetMap traces":ee,"Google Street View":q,Mapillary:Q},D="rident_map_view",_="rident_base_layer",z="rident_overlays";function te(){document.getElementById("map").style.display="block";const e=oe();ne(e);const r=L.control.layers(T,E,{collapsed:!0,autoZIndex:!1}).addTo(e),i=ae(e,T,E);return re(e,T,E),{map:e,baseLayers:T,overlays:E,currentBaseLayer:i,overlaysControl:r}}function oe(){const e=L.map("map",{minZoom:9,maxBounds:L.latLngBounds(M)});return e.attributionControl.setPrefix(""),e}function ne(e){const r=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(r){const n=+r[1],t=+r[2],o=+r[3];e.setView([t,o],n);return}const i=localStorage.getItem(D);if(i)try{const{center:n,zoom:t}=JSON.parse(i);e.setView(n,t);return}catch{}e.setView([18.79,98.98],10)}function ae(e,r,i){let n;const t=localStorage.getItem(_);t&&r[t]?(r[t].addTo(e),n=r[t]):(r["Google Terrain"].addTo(e),n=r["Google Terrain"]);const o=localStorage.getItem(z);let c=[];try{c=o?JSON.parse(o):[]}catch{}if(!c.length)i["Ride NT"].addTo(e);else for(const[p,d]of Object.entries(i))c.includes(p)&&d.addTo(e);return n}function re(e,r,i){e.on("baselayerchange",n=>{var o;const t=(o=Object.entries(r).find(([c,p])=>p===n.layer))==null?void 0:o[0];t&&localStorage.setItem(_,t)}),e.on("overlayadd overlayremove",()=>{const n=Object.entries(i).filter(([t,o])=>e.hasLayer(o)).map(([t])=>t);localStorage.setItem(z,JSON.stringify(n))}),e.on("moveend zoomend",()=>{const n=e.getCenter(),t=e.getZoom(),o=`#${t}/${n.lat.toFixed(6)}/${n.lng.toFixed(6)}`;location.hash=o,localStorage.setItem(D,JSON.stringify({center:n,zoom:t}))})}function ie(e){const r=L.control({position:"bottomright"});r.onAdd=function(){const i=L.DomUtil.create("div","info legend");i.style.position="relative",i.style.transition="all 0.3s ease",i.style.fontSize="14px",i.style.color="#333",i.style.maxWidth="250px";const n=1;let t=!1;function o(h){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${h.replace("OPACITY",n)};
				vertical-align:middle;
			"></span>`}const c="rgba(51, 102, 255, 1)",p="rgba(160,160,160,1)",d=document.createElement("div");d.style.background="rgba(255, 255, 255, 0.95)",d.style.borderRadius="6px",d.style.padding="8px",d.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",d.style.display="none",d.style.flexDirection="column";const s=document.createElement("div");s.style.display="flex",s.style.justifyContent="space-between",s.style.alignItems="center",s.style.marginBottom="6px";const y=document.createElement("span");y.textContent="RideNT Legend",y.style.fontWeight="bold";const g=document.createElement("a");g.href="#",g.innerHTML="🔽",g.title="Collapse legend",g.style.fontSize="18px",g.style.textDecoration="none",g.style.cursor="pointer",g.style.padding="4px",g.onclick=h=>{h.preventDefault(),t=!1,b()},s.appendChild(y),s.appendChild(g);const f=document.createElement("div");f.innerHTML=`
			${o(c)} Paved<br>
			${o("rgba(0,140,60,OPACITY)")} Fast dirt<br>
			${o("rgba(255,179,0,OPACITY)")} Moderate dirt<br>
			${o("rgba(255,40,40,OPACITY)")} Slow / Technical<br>
			${o("rgba(128,0,128,OPACITY)")} Very technical<br>
			${o(p)} Potential trail<br>
			<br>
			<span class="caption">Speeds are approximate, based on dry GPX tracks with climate & rider factors considered. Accuracy not guaranteed.</span>
		`,d.appendChild(s),d.appendChild(f);const u=document.createElement("a");u.href="#",u.innerHTML="❓",u.title="Show legend",u.style.display="none",u.style.textDecoration="none",u.style.fontSize="20px",u.style.width="36px",u.style.height="36px",u.style.textAlign="center",u.style.lineHeight="36px",u.style.borderRadius="6px",u.style.background="white",u.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",u.style.cursor="pointer",u.onclick=h=>{h.preventDefault(),t=!0,b()};function b(){d.style.display=t?"flex":"none",u.style.display=t?"none":"inline-block"}return b(),i.appendChild(d),i.appendChild(u),i},r.addTo(e)}function le(e,r,i){const n=document.getElementById("context-menu");function t(p,d){const s=document.createElement("div");s.innerText=p,s.style.padding="4px 8px",s.style.cursor="pointer",s.onmouseenter=()=>s.style.background="#eee",s.onmouseleave=()=>s.style.background="",s.onmousedown=()=>{d(),n.style.display="none"},n.appendChild(s)}function o(){const p=document.createElement("hr");p.style.margin="0",n.appendChild(p)}e.on("contextmenu",function(p){const d=p.latlng.lat.toFixed(6),s=p.latlng.lng.toFixed(6),y=e.getZoom();n.innerHTML="",t("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/edit?editor=id&lat=${d}&lon=${s}&zoom=${e.getZoom()}`,"_blank")}),o(),t("Open in Google Maps",()=>{const g=i===r["Google Satellite"],f=new URLSearchParams({api:1,map_action:"map",basemap:g?"satellite":"terrain",center:[d,s].join(","),zoom:y});window.open(`https://www.google.com/maps/@?${unescape(f)}`,"_blank")}),t("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${d},${s}`,"_blank")}),t("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${d},${s},${y}z?sport=mtb`,"_blank")}),t("Open in Mapillary",()=>{const g=new URLSearchParams({lat:d,lng:s,z:y});window.open(`https://www.mapillary.com/app/?${unescape(g)}`,"_blank")}),o(),t("Copy Coordinates",()=>{navigator.clipboard.writeText(`${d}, ${s}`).then(()=>{alert("Coordinates copied to clipboard.")})}),n.style.left=p.originalEvent.pageX+"px",n.style.top=p.originalEvent.pageY+"px",n.style.display="block"});const c=()=>n.style.display="none";e.on("mousedown",c),document.addEventListener("mousedown",c)}function se(e,r,i={}){const n=e.getContainer(),t=L.latLngBounds(M);["dragenter","dragover","dragleave","drop"].forEach(o=>{n.addEventListener(o,c=>c.preventDefault(),!1)}),n.addEventListener("drop",o=>{if(o.preventDefault(),!!o.dataTransfer.files.length)for(const c of o.dataTransfer.files){if(!c.name.toLowerCase().endsWith(".gpx"))continue;const p=new FileReader;p.onload=d=>{const s=d.target.result,y=new L.GPX(s,{async:!0,polyline_options:{color:"yellow",weight:20,opacity:.3},gpx_options:{joinTrackSegments:!1},markers:{startIcon:null,endIcon:null}});y.on("loaded",()=>{const g=y.getBounds();if(t.intersects(g)){y.addTo(e);const f=c.name.replace(/\.gpx$/i,"");i[f]=y,r.addOverlay(y,f),e.fitBounds(g)}else alert(`GPX file "${c.name}" is outside the allowed bounds and will not be displayed.`)})},p.readAsText(c)}})}function ce(e,r,i,n){function t(){document.getElementById("map").classList.toggle("hide-overlays")}document.addEventListener("keydown",o=>{const c=document.activeElement;c&&(c.tagName==="INPUT"||c.tagName==="TEXTAREA"||c.isContentEditable)||(o.key.toLowerCase()==="o"?t():o.key==="Delete"&&(localStorage.clear(),location.reload()))})}function de(e){const r=[];let i=null,n=!1;const t=a=>{const l=a.getZoom();return{color:"#9400D3",weight:Math.max(4,25-(18-l)*2),opacity:.3}},o=L.control({position:"bottomleft"});o.onAdd=function(){const a=L.DomUtil.create("div","leaflet-bar leaflet-control"),l=L.DomUtil.create("a","",a);l.href="#",l.innerHTML="🖊️",l.title="Toggle highlighter",l.style.padding="6px 10px",l.style.fontSize="20px";const m=L.DomUtil.create("a","",a);m.href="#",m.innerHTML="🧽",m.title="Clear highlights",m.style.padding="6px 10px",m.style.fontSize="20px",l.onclick=v=>{v.preventDefault(),n=!n,w()},m.onclick=v=>{v.preventDefault(),r.forEach(O=>e.removeLayer(O)),r.length=0,b()};function w(){n?(l.style.background="#ff0",l.style.color="black"):(l.style.background="white",l.style.color="")}return a},o.addTo(e);function c(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function p(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function d(a){return a.latlng?a.latlng:a.touches&&a.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(a.touches[0])):null}function s(a){if(!n)return;const l=d(a);l&&(c(),i=L.polyline([l],t(e)).addTo(e),r.push(i),a.preventDefault&&a.preventDefault())}function y(a){if(!n||!i)return;const l=d(a);l&&(i.addLatLng(l),a.preventDefault&&a.preventDefault())}function g(a){n&&i&&(i=null,n=!1,u(),b(),p()),a.preventDefault&&a.preventDefault()}e.on("mousedown",s),e.on("mousemove",y),e.on("mouseup",g);const f=e.getContainer();f.addEventListener("touchstart",s,{passive:!1}),f.addEventListener("touchmove",y,{passive:!1}),f.addEventListener("touchend",g,{passive:!1}),e.on("zoomend",()=>{r.forEach(a=>a.setStyle(t(e)))}),window.addEventListener("keydown",a=>{if(a.key.toLowerCase()==="d"&&(n=!n,u()),(a.ctrlKey||a.metaKey)&&a.key.toLowerCase()==="z"&&r.length>0){const l=r.pop();e.removeLayer(l),b()}});function u(){const a=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');a&&(n?(a.style.background="#ff0",a.style.color="black"):(a.style.background="white",a.style.color=""))}function b(){if(!r.length){h(null);return}const a=r.map(l=>polyline.encode(l.getLatLngs().map(m=>[m.lat,m.lng]))).join(";");h(a)}function h(a){const l=new URLSearchParams(window.location.search);a?l.set("data",a):l.delete("data");const m=window.location.pathname+(l.toString()?"?"+l.toString():"")+window.location.hash;window.history.replaceState(null,"",m)}function A(){const l=new URLSearchParams(window.location.search).get("data");if(!l)return;l.split(";").forEach(w=>{try{const v=polyline.decode(w).map(([B,Z])=>L.latLng(B,Z)),O=L.polyline(v,t(e)).addTo(e);r.push(O)}catch{console.warn("Invalid polyline segment:",w)}})}A()}G();const{map:x,baseLayers:$,overlays:P,currentBaseLayer:pe,overlaysControl:ue}=te();ie(x);le(x,$,pe);ce(x,P,$["Google Satellite"]);de(x);se(x,ue,P);window.addEventListener("load",k);document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&k()});
