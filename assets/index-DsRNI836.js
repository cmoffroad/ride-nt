(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();function N(){return location.hostname==="localhost"||location.hostname==="127.0.0.1"}const z="UmlkZVNhZmUyMDI1IQ==",C="rident_auth",U=30*24*60*60*1e3;function V(){const e=localStorage.getItem(C);if(!e)return!1;try{const{password:r,expires:s}=JSON.parse(e);return r===z&&Date.now()<s}catch{return!1}}function W(){const e=Date.now()+U;localStorage.setItem(C,JSON.stringify({password:z,expires:e}))}function D(){V()||(prompt("Enter password to view the map:")!==atob(z)&&(alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>"),W()),document.body.classList.remove("locked")}const x={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:103},M=[[x.minLat,x.minLon],[x.maxLat,x.maxLon]],h={fast:"rgba(0, 140, 60, 1)",moderate:"rgba(255, 179, 0, 1)",slow:"rgba(255, 40, 40, 1)",veryTechnical:"rgba(128, 0, 128, 1)",maybe:"rgba(180, 180, 180, 1)",likely:"rgba(100, 100, 100, 1)",paved:"rgba(51, 102, 255, 1)"},k={satellite:"s",terrain:"p",hybrid:"h"},H=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${k.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),F=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${k.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,opacity:.5}),K=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${k.hybrid}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,transparent:!0,zIndex:2}),Y=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:19}),j=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17}),J=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17}),q=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"]}),X=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxNativeZoom:19}),Q=L.tileLayer("./tiles/{z}/{x}/{y}.png?ts=1751952124083.0012",{tileSize:256,opacity:1,minNativeZoom:10,maxNativeZoom:13,zIndex:3,className:"overlay"}),ee=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],maxNativeZoom:13,maxZoom:20,opacity:.7,zIndex:1,className:"overlay"}),te=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10,opacity:.7})}}),oe=L.tileLayer("https://karta-gateway.geo.azure.myteksi.net/view/api/2.0/sequence/tiles/{x}/{y}/{z}.png",{transparent:!0,minNativeZoom:13,maxNativeZoom:20,className:"overlay"}),ne=L.tileLayer("https://content-{s}.strava.com/identified/globalheat/all/hot/{z}/{x}/{y}.png?v=19",{subdomains:["a"],maxNativeZoom:16,maxZoom:20,opacity:.6,zIndex:2,className:"overlay"}),ae=L.tileLayer("https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png",{transparent:!0,maxNativeZoom:18,zIndex:2,className:"overlay"}),S={"Google Terrain":F,"OSM Standard":q,"World Topo Map":X,"Google Satellite":H,"ESRI Firefly":Y,"ESRI Clarity":j,"ESRI Wayback":J},f={"Ride NT":Q,"OpenStreetMap traces":ae};N()&&(f["Google Street View"]=ee,f["Google Hybrid"]=K,f.Mapillary=te,f.KartaView=oe,f["Strava Heatmap"]=ne);const $="rident_map_view",Z="rident_base_layer",_="rident_overlays";function re(){document.getElementById("map").style.display="block";const e=se();ie(e);const r=L.control.layers(S,f,{collapsed:!0,autoZIndex:!1}).addTo(e),s=le(e,S,f);return ce(e,S,f),{map:e,baseLayers:S,overlays:f,currentBaseLayer:s,overlaysControl:r}}function se(){const e=L.map("map",{minZoom:9,maxBounds:L.latLngBounds(M)});return e.attributionControl.setPrefix(""),e}function ie(e){const r=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(r){const n=+r[1],t=+r[2],o=+r[3];e.setView([t,o],n);return}const s=localStorage.getItem($);if(s)try{const{center:n,zoom:t}=JSON.parse(s);e.setView(n,t);return}catch{}e.setView([18.79,98.98],10)}function le(e,r,s){let n;const t=localStorage.getItem(Z);t&&r[t]?(r[t].addTo(e),n=r[t]):(r["Google Terrain"].addTo(e),n=r["Google Terrain"]);const o=localStorage.getItem(_);let i=[];try{i=o?JSON.parse(o):[]}catch{}if(!i.length)s["Ride NT"].addTo(e);else for(const[m,d]of Object.entries(s))i.includes(m)&&d.addTo(e);return n}function ce(e,r,s){e.on("baselayerchange",n=>{var o;const t=(o=Object.entries(r).find(([i,m])=>m===n.layer))==null?void 0:o[0];t&&localStorage.setItem(Z,t)}),e.on("overlayadd overlayremove",()=>{const n=Object.entries(s).filter(([t,o])=>e.hasLayer(o)).map(([t])=>t);localStorage.setItem(_,JSON.stringify(n))}),e.on("moveend zoomend",()=>{const n=e.getCenter(),t=e.getZoom(),o=`#${t}/${n.lat.toFixed(6)}/${n.lng.toFixed(6)}`;location.hash=o,localStorage.setItem($,JSON.stringify({center:n,zoom:t}))})}function de(e){const r=L.control({position:"bottomright"});r.onAdd=function(){const s=L.DomUtil.create("div","info legend");s.style.position="relative",s.style.transition="all 0.3s ease",s.style.fontSize="14px",s.style.color="#333",s.style.maxWidth="250px";let n=!1;function t(y){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${y};
				vertical-align:middle;
			"></span>`}const o=document.createElement("div");o.style.background="rgba(255, 255, 255, 0.95)",o.style.borderRadius="6px",o.style.padding="8px",o.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",o.style.display="none",o.style.flexDirection="column";const i=document.createElement("div");i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.marginBottom="6px";const m=document.createElement("span");m.textContent="RideNT Legend",m.style.fontWeight="bold";const d=document.createElement("a");d.href="#",d.innerHTML="🔽",d.title="Collapse legend",d.style.fontSize="18px",d.style.textDecoration="none",d.style.cursor="pointer",d.style.padding="4px",d.onclick=y=>{y.preventDefault(),n=!1,u()},i.appendChild(m),i.appendChild(d);const p=document.createElement("div");p.innerHTML=`
			${t(h.paved)} Paved<br>
			${t(h.fast)} Fast dirt<br>
			${t(h.moderate)} Moderate dirt<br>
			${t(h.slow)} Slow / Technical<br>
			${t(h.veryTechnical)} Very technical<br>
			${t(h.likely)} Rural roads<br>
			${t(h.maybe)} Uncertain trails<br>
			<br>
			<span class="caption">Speeds are approximate, based on dry GPX tracks with climate & rider factors considered. Accuracy not guaranteed.</span>
		`,o.appendChild(i),o.appendChild(p);const l=document.createElement("a");l.href="#",l.innerHTML="❓",l.title="Show legend",l.style.display="none",l.style.textDecoration="none",l.style.fontSize="20px",l.style.width="36px",l.style.height="36px",l.style.textAlign="center",l.style.lineHeight="36px",l.style.borderRadius="6px",l.style.background="white",l.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",l.style.cursor="pointer",l.onclick=y=>{y.preventDefault(),n=!0,u()};function u(){o.style.display=n?"flex":"none",l.style.display=n?"none":"inline-block"}return u(),s.appendChild(o),s.appendChild(l),s},r.addTo(e)}function pe(e,r,s){const n=document.getElementById("context-menu");function t(m,d){const p=document.createElement("div");p.innerText=m,p.style.padding="4px 8px",p.style.cursor="pointer",p.onmouseenter=()=>p.style.background="#eee",p.onmouseleave=()=>p.style.background="",p.onmousedown=()=>{d(),n.style.display="none"},n.appendChild(p)}function o(){const m=document.createElement("hr");m.style.margin="0",n.appendChild(m)}e.on("contextmenu",function(m){const d=m.latlng.lat.toFixed(6),p=m.latlng.lng.toFixed(6),l=e.getZoom();n.innerHTML="",t("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/id?#map=${Math.max(16,e.getZoom())}/${d}/${p}`)}),o(),t("Open in Google Maps",()=>{const u=s===r["Google Satellite"],y=new URLSearchParams({api:1,map_action:"map",basemap:u?"satellite":"terrain",center:[d,p].join(","),zoom:l});window.open(`https://www.google.com/maps/@?${unescape(y)}`)}),t("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${d},${p}`)}),t("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${d},${p},${l}z?sport=mtb`)}),N()&&t("Open in Mapillary",()=>{const u=new URLSearchParams({lat:d,lng:p,z:l});window.open(`https://www.mapillary.com/app/?${unescape(u)}`)}),o(),t("Copy Coordinates",()=>{navigator.clipboard.writeText(`${d}, ${p}`).then(()=>{alert("Coordinates copied to clipboard.")})}),n.style.left=m.originalEvent.pageX+"px",n.style.top=m.originalEvent.pageY+"px",n.style.display="block"});const i=()=>n.style.display="none";e.on("mousedown",i),document.addEventListener("mousedown",i)}function me(e,r,s={}){const n=e.getContainer(),t=L.latLngBounds(M);["dragenter","dragover","dragleave","drop"].forEach(o=>{n.addEventListener(o,i=>i.preventDefault(),!1)}),n.addEventListener("drop",o=>{if(o.preventDefault(),!!o.dataTransfer.files.length)for(const i of o.dataTransfer.files){if(!i.name.toLowerCase().endsWith(".gpx"))continue;const m=new FileReader;m.onload=d=>{const p=d.target.result,l=new L.GPX(p,{async:!0,polyline_options:{color:"yellow",weight:20,opacity:.3},gpx_options:{joinTrackSegments:!1},markers:{startIcon:null,endIcon:null}});l.on("loaded",()=>{const u=l.getBounds();if(t.intersects(u)){l.addTo(e);const y=i.name.replace(/\.gpx$/i,"");s[y]=l,r.addOverlay(l,y),e.fitBounds(u)}else alert(`GPX file "${i.name}" is outside the allowed bounds and will not be displayed.`)})},m.readAsText(i)}})}function ye(e,r,s,n){function t(){document.getElementById("map").classList.toggle("hide-overlays")}document.addEventListener("keydown",o=>{const i=document.activeElement;i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.isContentEditable)||(o.key.toLowerCase()==="o"?t():o.key==="Delete"&&(localStorage.clear(),location.reload()))})}function ue(e){const r=[];let s=null,n=!1;const t=a=>{const c=a.getZoom();return{color:"#9400D3",weight:Math.max(4,25-(18-c)*2),opacity:.3}},o=L.control({position:"bottomleft"});o.onAdd=function(){const a=L.DomUtil.create("div","leaflet-bar leaflet-control"),c=L.DomUtil.create("a","",a);c.href="#",c.innerHTML="🖊️",c.title="Toggle highlighter",c.style.padding="6px 10px",c.style.fontSize="20px";const g=L.DomUtil.create("a","",a);g.href="#",g.innerHTML="🧽",g.title="Clear highlights",g.style.padding="6px 10px",g.style.fontSize="20px",c.onclick=v=>{v.preventDefault(),n=!n,b()},g.onclick=v=>{v.preventDefault(),r.forEach(E=>e.removeLayer(E)),r.length=0,T()},L.DomEvent.disableClickPropagation(a),L.DomEvent.disableScrollPropagation(a);function b(){n?(c.style.background="#ff0",c.style.color="black"):(c.style.background="white",c.style.color="")}return a},o.addTo(e);function i(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function m(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function d(a){return a.latlng?a.latlng:a.touches&&a.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(a.touches[0])):null}function p(a){if(!n)return;const c=d(a);c&&(i(),s=L.polyline([c],t(e)).addTo(e),r.push(s),a.preventDefault&&a.preventDefault())}function l(a){if(!n||!s)return;const c=d(a);c&&(s.addLatLng(c),a.preventDefault&&a.preventDefault())}function u(a){n&&s&&(s=null,n=!1,I(),T(),m()),a.preventDefault&&a.preventDefault()}e.on("mousedown",p),e.on("mousemove",l),e.on("mouseup",u);const y=e.getContainer();y.addEventListener("touchstart",p,{passive:!0}),y.addEventListener("touchmove",l,{passive:!0}),y.addEventListener("touchend",u,{passive:!0}),e.on("zoomend",()=>{r.forEach(a=>a.setStyle(t(e)))}),window.addEventListener("keydown",a=>{if(a.key.toLowerCase()==="d"&&(n=!n,I()),(a.ctrlKey||a.metaKey)&&a.key.toLowerCase()==="z"&&r.length>0){const c=r.pop();e.removeLayer(c),T()}});function I(){const a=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');a&&(n?(a.style.background="#ff0",a.style.color="black"):(a.style.background="white",a.style.color=""))}function T(){if(!r.length){O(null);return}const a=r.map(c=>polyline.encode(c.getLatLngs().map(g=>[g.lat,g.lng]))).join(";");O(a)}function O(a){const c=new URLSearchParams(window.location.search);a?c.set("data",a):c.delete("data");const g=window.location.pathname+(c.toString()?"?"+c.toString():"")+window.location.hash;window.history.replaceState(null,"",g)}function G(){const c=new URLSearchParams(window.location.search).get("data");if(!c)return;c.split(";").forEach(b=>{try{const v=polyline.decode(b).map(([R,A])=>L.latLng(R,A)),E=L.polyline(v,t(e)).addTo(e);r.push(E)}catch{console.warn("Invalid polyline segment:",b)}})}G()}N()&&(document.title="🤖"+document.title);const{map:w,baseLayers:B,overlays:P,currentBaseLayer:ge,overlaysControl:fe}=re();de(w);pe(w,B,ge);ye(w,P,B["Google Satellite"]);ue(w);me(w,fe,P);window.addEventListener("load",D);document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&D()});
