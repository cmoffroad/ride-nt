(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function a(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=a(t);fetch(t.href,o)}})();function D(){return location.hostname==="localhost"||location.hostname==="127.0.0.1"}const k="UmlkZVNhZmUyMDI1IQ==",Z="rident_auth",F=30*24*60*60*1e3;function H(){const e=localStorage.getItem(Z);if(!e)return!1;try{const{password:c,expires:a}=JSON.parse(e);return c===k&&Date.now()<a}catch{return!1}}function j(){const e=Date.now()+F;localStorage.setItem(Z,JSON.stringify({password:k,expires:e}))}function _(){H()||(prompt("Enter password to view the map:")!==atob(k)&&(alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>"),j()),document.body.classList.remove("locked")}const T={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:103},$=[[T.minLat,T.minLon],[T.maxLat,T.maxLon]],v={fast:"rgba(0, 140, 60, 1)",moderate:"rgba(255, 179, 0, 1)",slow:"rgba(255, 40, 40, 1)",veryTechnical:"rgba(128, 0, 128, 1)",maybe:"rgba(180, 180, 180, 1)",likely:"rgba(100, 100, 100, 1)",paved:"rgba(51, 102, 255, 1)"},C={satellite:"s",terrain:"p",hybrid:"h"},K=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${C.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),Y=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${C.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),J=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${C.hybrid}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,transparent:!0,zIndex:2}),q=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:19}),X=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17}),Q=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17}),ee=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"]}),te=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxNativeZoom:19}),oe=L.tileLayer("./tiles/{z}/{x}/{y}.png?ts=1752046557984.9292",{tileSize:256,minNativeZoom:10,maxNativeZoom:13,zIndex:3,className:"overlay"}),ne=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],maxNativeZoom:13,maxZoom:20,zIndex:1,className:"overlay"}),ae=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10})}}),re=L.tileLayer("https://karta-gateway.geo.azure.myteksi.net/view/api/2.0/sequence/tiles/{x}/{y}/{z}.png",{transparent:!0,minNativeZoom:13,maxNativeZoom:20,className:"overlay"});L.tileLayer("https://content-{s}.strava.com/identified/globalheat/all/hot/{z}/{x}/{y}.png?v=19",{subdomains:["a"],maxNativeZoom:16,maxZoom:20,zIndex:2,className:"overlay"});const se=L.tileLayer("https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png",{transparent:!0,maxNativeZoom:18,zIndex:2,className:"overlay"}),O={"World Topo Map":te,"OSM Standard":ee,"Google Terrain":Y},N={"Google Satellite":K,"ESRI Firefly":q,"ESRI Clarity":X,"ESRI Wayback":Q},h={"Ride NT":oe,"OpenStreetMap traces":se};D()&&(h["Google Street View"]=ne,h["Google Hybrid"]=J,h.Mapillary=ae,h.KartaView=re);let b=0;function le(e,c,a){const n=L.control({position:"topright"});n.onAdd=function(){const t=L.DomUtil.create("div","leaflet-control leaflet-top-center leaflet-control-layers leaflet-control-layers-expanded transparency-toolbar"),o=L.DomUtil.create("select","",t);o.className="transparency-select",Object.keys(a).forEach(l=>{const m=document.createElement("option");m.value=l,m.textContent=l,o.appendChild(m)});const d=localStorage.getItem("rident_satellite"),p=d&&a[d]?d:Object.keys(a)[0];o.value=p;let s=a[p];s.addTo(e),s.setOpacity(b/100),s.setZIndex(1);const i=L.DomUtil.create("input","",t);return i.className="transparency-slider",i.type="range",i.min=0,i.max=100,i.step=1,i.value=b,L.DomEvent.on(i,"input",l=>{const m=parseFloat(l.target.value);b=m;const u=(100-m)/100;Object.values(c).forEach(x=>{typeof x.setOpacity=="function"&&x.setOpacity(u)}),s&&s.setOpacity(b/100)}),L.DomEvent.on(o,"change",l=>{const m=l.target.value;e.hasLayer(s)&&e.removeLayer(s),s=a[m],s.addTo(e),s.setOpacity(b/100),s.setZIndex(1),localStorage.setItem("rident_satellite",m)}),L.DomEvent.disableClickPropagation(t),t},n.addTo(e)}const B="rident_map_view",P="rident_base_layer",A="rident_satellite",G="rident_overlays";function ie(){document.getElementById("map").style.display="block";const e=ce();de(e);const c=L.control.layers(O,h,{collapsed:!0,autoZIndex:!1}).addTo(e),a=pe(e,O,h,N);return ye(e,O,h),{map:e,baseLayers:O,satelliteLayers:N,overlays:h,currentBaseLayer:a,layersControl:c}}function ce(){const e=L.map("map",{minZoom:9,maxBounds:L.latLngBounds($)});return e.attributionControl.setPrefix(""),e}function de(e){const c=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(c){const n=+c[1],t=+c[2],o=+c[3];e.setView([t,o],n);return}const a=localStorage.getItem(B);if(a)try{const{center:n,zoom:t}=JSON.parse(a);e.setView(n,t);return}catch{}e.setView([18.79,98.98],10)}function pe(e,c,a,n){let t;const o=localStorage.getItem(P);o&&c[o]?(c[o].addTo(e),t=c[o]):(c["World Topo Map"].addTo(e),t=c["World Topo Map"]);const d=localStorage.getItem(G);let p=[];try{p=d?JSON.parse(d):[]}catch{}if(p.length)for(const[l,m]of Object.entries(a))p.includes(l)&&m.addTo(e);const s=localStorage.getItem(A);let i;return s&&n[s]?i=n[s]:i=n["Google Satellite"],i&&(i.setOpacity(b/100),i.addTo(e)),t}function ye(e,c,a){e.on("baselayerchange",n=>{const t=Object.entries(c).find(([d,p])=>p===n.layer);t&&(localStorage.setItem(P,t[0]),t[1].setZIndex(0));const o=Object.entries(N).find(([d,p])=>p===n.layer);o&&(localStorage.setItem(A,o[0]),o[1].setZIndex(1),o[1].setOpacity(b/100))}),e.on("overlayadd overlayremove",()=>{const n=Object.entries(a).filter(([t,o])=>e.hasLayer(o)).map(([t])=>t);localStorage.setItem(G,JSON.stringify(n))}),e.on("moveend zoomend",()=>{const n=e.getCenter(),t=e.getZoom(),o=`#${t}/${n.lat.toFixed(6)}/${n.lng.toFixed(6)}`;location.hash=o,localStorage.setItem(B,JSON.stringify({center:n,zoom:t}))})}function me(e){const c=L.control({position:"bottomright"});c.onAdd=function(){const a=L.DomUtil.create("div","info legend");a.style.position="relative",a.style.transition="all 0.3s ease",a.style.fontSize="14px",a.style.color="#333",a.style.maxWidth="250px";let n=!1;function t(u){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${u};
				vertical-align:middle;
			"></span>`}const o=document.createElement("div");o.style.background="rgba(255, 255, 255, 0.95)",o.style.borderRadius="6px",o.style.padding="8px",o.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",o.style.display="none",o.style.flexDirection="column";const d=document.createElement("div");d.style.display="flex",d.style.justifyContent="space-between",d.style.alignItems="center",d.style.marginBottom="6px";const p=document.createElement("span");p.textContent="RideNT Legend",p.style.fontWeight="bold";const s=document.createElement("a");s.href="#",s.innerHTML="🔽",s.title="Collapse legend",s.style.fontSize="18px",s.style.textDecoration="none",s.style.cursor="pointer",s.style.padding="4px",s.onclick=u=>{u.preventDefault(),n=!1,m()},d.appendChild(p),d.appendChild(s);const i=document.createElement("div");i.innerHTML=`
			${t(v.paved)} Paved<br>
			${t(v.fast)} Fast dirt<br>
			${t(v.moderate)} Moderate dirt<br>
			${t(v.slow)} Slow / Technical<br>
			${t(v.veryTechnical)} Very technical<br>
			${t(v.likely)} Rural roads<br>
			${t(v.maybe)} Uncertain trails<br>
			<br>
			<span class="caption">Speeds are approximate, based on dry GPX tracks with climate & rider factors considered. Accuracy not guaranteed.</span>
		`,o.appendChild(d),o.appendChild(i);const l=document.createElement("a");l.href="#",l.innerHTML="❓",l.title="Show legend",l.style.display="none",l.style.textDecoration="none",l.style.fontSize="20px",l.style.width="36px",l.style.height="36px",l.style.textAlign="center",l.style.lineHeight="36px",l.style.borderRadius="6px",l.style.background="white",l.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",l.style.cursor="pointer",l.onclick=u=>{u.preventDefault(),n=!0,m()};function m(){o.style.display=n?"flex":"none",l.style.display=n?"none":"inline-block"}return m(),a.appendChild(o),a.appendChild(l),a},c.addTo(e)}function ue(e,c,a){const n=document.getElementById("context-menu");function t(p,s){const i=document.createElement("div");i.innerText=p,i.style.padding="4px 8px",i.style.cursor="pointer",i.onmouseenter=()=>i.style.background="#eee",i.onmouseleave=()=>i.style.background="",i.onmousedown=()=>{s(),n.style.display="none"},n.appendChild(i)}function o(){const p=document.createElement("hr");p.style.margin="0",n.appendChild(p)}e.on("contextmenu",function(p){const s=p.latlng.lat.toFixed(6),i=p.latlng.lng.toFixed(6),l=e.getZoom();n.innerHTML="",t("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/id?#map=${Math.max(16,e.getZoom())}/${s}/${i}`)}),o(),t("Open in Google Maps",()=>{const m=a===c["Google Satellite"],u=new URLSearchParams({api:1,map_action:"map",basemap:m?"satellite":"terrain",center:[s,i].join(","),zoom:l});window.open(`https://www.google.com/maps/@?${unescape(u)}`)}),t("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${s},${i}`)}),t("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${s},${i},${l}z?sport=mtb`)}),D()&&t("Open in Mapillary",()=>{const m=new URLSearchParams({lat:s,lng:i,z:l});window.open(`https://www.mapillary.com/app/?${unescape(m)}`)}),o(),t("Copy Coordinates",()=>{navigator.clipboard.writeText(`${s}, ${i}`).then(()=>{alert("Coordinates copied to clipboard.")})}),n.style.left=p.originalEvent.pageX+"px",n.style.top=p.originalEvent.pageY+"px",n.style.display="block"});const d=()=>n.style.display="none";e.on("mousedown",d),document.addEventListener("mousedown",d)}function ge(e,c,a={}){const n=e.getContainer(),t=L.latLngBounds($);["dragenter","dragover","dragleave","drop"].forEach(o=>{n.addEventListener(o,d=>d.preventDefault(),!1)}),n.addEventListener("drop",o=>{if(o.preventDefault(),!!o.dataTransfer.files.length)for(const d of o.dataTransfer.files){if(!d.name.toLowerCase().endsWith(".gpx"))continue;const p=new FileReader;p.onload=s=>{const i=s.target.result,l=new L.GPX(i,{async:!0,polyline_options:{color:"yellow",weight:20,opacity:.3},gpx_options:{joinTrackSegments:!1},markers:{startIcon:null,endIcon:null}});l.on("loaded",()=>{const m=l.getBounds();if(t.intersects(m)){l.addTo(e);const u=d.name.replace(/\.gpx$/i,"");a[u]=l,c.addOverlay(l,u),e.fitBounds(m)}else alert(`GPX file "${d.name}" is outside the allowed bounds and will not be displayed.`)})},p.readAsText(d)}})}function fe(e,c,a,n){function t(){document.getElementById("map").classList.toggle("hide-overlays")}document.addEventListener("keydown",o=>{const d=document.activeElement;d&&(d.tagName==="INPUT"||d.tagName==="TEXTAREA"||d.isContentEditable)||(o.key.toLowerCase()==="o"?t():o.key==="Delete"&&(localStorage.clear(),location.reload()))})}const f=[];function he(e){let c=null,a=!1;const n=r=>{const y=r.getZoom();return{color:"#9400D3",weight:Math.max(4,25-(18-y)*2),opacity:.3}},t=L.control({position:"bottomleft"});t.onAdd=function(){const r=L.DomUtil.create("div","leaflet-bar leaflet-control"),y=L.DomUtil.create("a","",r);y.href="#",y.innerHTML="🖊️",y.title="Toggle highlighter",y.style.padding="6px 10px",y.style.fontSize="20px";const g=L.DomUtil.create("a","",r);g.href="#",g.innerHTML="🧽",g.title="Clear highlights",g.style.padding="6px 10px",g.style.fontSize="20px",y.onclick=w=>{w.preventDefault(),a=!a,E()},g.onclick=w=>{w.preventDefault(),f.forEach(I=>e.removeLayer(I)),f.length=0,x()},L.DomEvent.disableClickPropagation(r),L.DomEvent.disableScrollPropagation(r);function E(){a?(y.style.background="#ff0",y.style.color="black"):(y.style.background="white",y.style.color="")}return r},t.addTo(e);function o(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function d(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function p(r){return r.latlng?r.latlng:r.touches&&r.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(r.touches[0])):null}function s(r){if(!a)return;const y=p(r);y&&(o(),c=L.polyline([y],n(e)).addTo(e),f.push(c),r.preventDefault&&r.preventDefault())}function i(r){if(!a||!c)return;const y=p(r);y&&(c.addLatLng(y),r.preventDefault&&r.preventDefault())}function l(r){a&&c&&(c=null,a=!1,u(),x(),d()),r.preventDefault&&r.preventDefault()}e.on("mousedown",s),e.on("mousemove",i),e.on("mouseup",l);const m=e.getContainer();m.addEventListener("touchstart",s,{passive:!0}),m.addEventListener("touchmove",i,{passive:!0}),m.addEventListener("touchend",l,{passive:!0}),e.on("zoomend",()=>{f.forEach(r=>r.setStyle(n(e)))}),window.addEventListener("keydown",r=>{if(r.key.toLowerCase()==="d"&&(a=!a,u()),(r.ctrlKey||r.metaKey)&&r.key.toLowerCase()==="z"&&f.length>0){const y=f.pop();e.removeLayer(y),x()}});function u(){const r=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');r&&(a?(r.style.background="#ff0",r.style.color="black"):(r.style.background="white",r.style.color=""))}function x(){if(!f.length){M(null);return}const r=f.map(y=>polyline.encode(y.getLatLngs().map(g=>[g.lat,g.lng]))).join(";");M(r)}function M(r){const y=new URLSearchParams(window.location.search);r?y.set("data",r):y.delete("data");const g=window.location.pathname+(y.toString()?"?"+y.toString():"")+window.location.hash;window.history.replaceState(null,"",g)}function U(){const y=new URLSearchParams(window.location.search).get("data");if(!y)return;y.split(";").forEach(E=>{try{const w=polyline.decode(E).map(([W,V])=>L.latLng(W,V)),I=L.polyline(w,n(e)).addTo(e);f.push(I)}catch{console.warn("Invalid polyline segment:",E)}})}U()}D()&&(document.title="🤖"+document.title);const{map:S,baseLayers:R,satelliteLayers:ve,overlays:z,currentBaseLayer:Le,layersControl:be}=ie();me(S);ue(S,R,Le);fe(S,z,R["Google Satellite"]);he(S);ge(S,be,z);le(S,z,ve);window.addEventListener("load",_);document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&_()});
