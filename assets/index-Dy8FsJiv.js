(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=i(t);fetch(t.href,o)}})();function C(){return location.hostname==="localhost"||location.hostname==="127.0.0.1"}const I="UmlkZVNhZmUyMDI1IQ==",N="rident_auth",R=30*24*60*60*1e3;function V(){const e=localStorage.getItem(N);if(!e)return!1;try{const{password:r,expires:i}=JSON.parse(e);return r===I&&Date.now()<i}catch{return!1}}function U(){const e=Date.now()+R;localStorage.setItem(N,JSON.stringify({password:I,expires:e}))}function z(){V()||(prompt("Enter password to view the map:")!==atob(I)&&(alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>"),U()),document.body.classList.remove("locked")}const T={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:103},M=[[T.minLat,T.minLon],[T.maxLat,T.maxLon]],D={satellite:"s",terrain:"p"},W=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${D.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],attribution:"&copy; Google Satellite",maxNativeZoom:18}),Y=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${D.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],attribution:"&copy; Google Terrain",maxNativeZoom:18,opacity:.5}),H=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:19}),F=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17}),K=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17}),j=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"],attribution:"&copy; OpenStreetMap contributors"}),J=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxNativeZoom:19}),q=L.tileLayer("./tiles/{z}/{x}/{y}.png?ts=1751904445255.8079",{tileSize:256,opacity:1,minNativeZoom:10,maxNativeZoom:13,attribution:"Ride NT",zIndex:3,className:"overlay"}),X=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],attribution:"&copy; Google Street View",maxNativeZoom:13,maxZoom:20,opacity:.7,zIndex:1,className:"overlay"}),Q=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10,opacity:.7})}}),ee=L.tileLayer("https://karta-gateway.geo.azure.myteksi.net/view/api/2.0/sequence/tiles/{x}/{y}/{z}.png",{transparent:!0,minNativeZoom:13,maxNativeZoom:20,className:"overlay"}),te=L.tileLayer("https://content-{s}.strava.com/identified/globalheat/all/hot/{z}/{x}/{y}.png?v=19",{subdomains:["a"],attribution:'&copy; <a href="https://www.strava.com/">Strava</a>',maxNativeZoom:16,maxZoom:20,opacity:.6,zIndex:2,className:"overlay"}),oe=L.tileLayer("https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png",{transparent:!0,maxNativeZoom:18,zIndex:2,className:"overlay"}),E={"Google Terrain":Y,"OSM Standard":j,"World Topo Map":J,"Google Satellite":W,"ESRI Firefly":H,"ESRI Clarity":F,"ESRI Wayback":K},v={"Ride NT":q,"OpenStreetMap traces":oe};C()&&(v["Google Street View"]=X,v.Mapillary=Q,v.KartaView=ee,v["Strava Heatmap"]=te);const k="rident_map_view",P="rident_base_layer",Z="rident_overlays";function ne(){document.getElementById("map").style.display="block";const e=ae();re(e);const r=L.control.layers(E,v,{collapsed:!0,autoZIndex:!1}).addTo(e),i=ie(e,E,v);return se(e,E,v),{map:e,baseLayers:E,overlays:v,currentBaseLayer:i,overlaysControl:r}}function ae(){const e=L.map("map",{minZoom:9,maxBounds:L.latLngBounds(M)});return e.attributionControl.setPrefix(""),e}function re(e){const r=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(r){const n=+r[1],t=+r[2],o=+r[3];e.setView([t,o],n);return}const i=localStorage.getItem(k);if(i)try{const{center:n,zoom:t}=JSON.parse(i);e.setView(n,t);return}catch{}e.setView([18.79,98.98],10)}function ie(e,r,i){let n;const t=localStorage.getItem(P);t&&r[t]?(r[t].addTo(e),n=r[t]):(r["Google Terrain"].addTo(e),n=r["Google Terrain"]);const o=localStorage.getItem(Z);let c=[];try{c=o?JSON.parse(o):[]}catch{}if(!c.length)i["Ride NT"].addTo(e);else for(const[p,d]of Object.entries(i))c.includes(p)&&d.addTo(e);return n}function se(e,r,i){e.on("baselayerchange",n=>{var o;const t=(o=Object.entries(r).find(([c,p])=>p===n.layer))==null?void 0:o[0];t&&localStorage.setItem(P,t)}),e.on("overlayadd overlayremove",()=>{const n=Object.entries(i).filter(([t,o])=>e.hasLayer(o)).map(([t])=>t);localStorage.setItem(Z,JSON.stringify(n))}),e.on("moveend zoomend",()=>{const n=e.getCenter(),t=e.getZoom(),o=`#${t}/${n.lat.toFixed(6)}/${n.lng.toFixed(6)}`;location.hash=o,localStorage.setItem(k,JSON.stringify({center:n,zoom:t}))})}function le(e){const r=L.control({position:"bottomright"});r.onAdd=function(){const i=L.DomUtil.create("div","info legend");i.style.position="relative",i.style.transition="all 0.3s ease",i.style.fontSize="14px",i.style.color="#333",i.style.maxWidth="250px";const n=1;let t=!1;function o(h){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${h.replace("OPACITY",n)};
				vertical-align:middle;
			"></span>`}const c="rgba(51, 102, 255, 1)",p="rgba(160,160,160,1)",d=document.createElement("div");d.style.background="rgba(255, 255, 255, 0.95)",d.style.borderRadius="6px",d.style.padding="8px",d.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",d.style.display="none",d.style.flexDirection="column";const l=document.createElement("div");l.style.display="flex",l.style.justifyContent="space-between",l.style.alignItems="center",l.style.marginBottom="6px";const y=document.createElement("span");y.textContent="RideNT Legend",y.style.fontWeight="bold";const m=document.createElement("a");m.href="#",m.innerHTML="🔽",m.title="Collapse legend",m.style.fontSize="18px",m.style.textDecoration="none",m.style.cursor="pointer",m.style.padding="4px",m.onclick=h=>{h.preventDefault(),t=!1,b()},l.appendChild(y),l.appendChild(m);const f=document.createElement("div");f.innerHTML=`
			${o(c)} Paved<br>
			${o("rgba(0,140,60,OPACITY)")} Fast dirt<br>
			${o("rgba(255,179,0,OPACITY)")} Moderate dirt<br>
			${o("rgba(255,40,40,OPACITY)")} Slow / Technical<br>
			${o("rgba(128,0,128,OPACITY)")} Very technical<br>
			${o(p)} Potential trail<br>
			<br>
			<span class="caption">Speeds are approximate, based on dry GPX tracks with climate & rider factors considered. Accuracy not guaranteed.</span>
		`,d.appendChild(l),d.appendChild(f);const u=document.createElement("a");u.href="#",u.innerHTML="❓",u.title="Show legend",u.style.display="none",u.style.textDecoration="none",u.style.fontSize="20px",u.style.width="36px",u.style.height="36px",u.style.textAlign="center",u.style.lineHeight="36px",u.style.borderRadius="6px",u.style.background="white",u.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",u.style.cursor="pointer",u.onclick=h=>{h.preventDefault(),t=!0,b()};function b(){d.style.display=t?"flex":"none",u.style.display=t?"none":"inline-block"}return b(),i.appendChild(d),i.appendChild(u),i},r.addTo(e)}function ce(e,r,i){const n=document.getElementById("context-menu");function t(p,d){const l=document.createElement("div");l.innerText=p,l.style.padding="4px 8px",l.style.cursor="pointer",l.onmouseenter=()=>l.style.background="#eee",l.onmouseleave=()=>l.style.background="",l.onmousedown=()=>{d(),n.style.display="none"},n.appendChild(l)}function o(){const p=document.createElement("hr");p.style.margin="0",n.appendChild(p)}e.on("contextmenu",function(p){const d=p.latlng.lat.toFixed(6),l=p.latlng.lng.toFixed(6),y=e.getZoom();n.innerHTML="",t("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/edit?editor=id&lat=${d}&lon=${l}&zoom=${Math.max(16,e.getZoom())}`)}),o(),t("Open in Google Maps",()=>{const m=i===r["Google Satellite"],f=new URLSearchParams({api:1,map_action:"map",basemap:m?"satellite":"terrain",center:[d,l].join(","),zoom:y});window.open(`https://www.google.com/maps/@?${unescape(f)}`)}),t("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${d},${l}`)}),t("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${d},${l},${y}z?sport=mtb`)}),C()&&t("Open in Mapillary",()=>{const m=new URLSearchParams({lat:d,lng:l,z:y});window.open(`https://www.mapillary.com/app/?${unescape(m)}`)}),o(),t("Copy Coordinates",()=>{navigator.clipboard.writeText(`${d}, ${l}`).then(()=>{alert("Coordinates copied to clipboard.")})}),n.style.left=p.originalEvent.pageX+"px",n.style.top=p.originalEvent.pageY+"px",n.style.display="block"});const c=()=>n.style.display="none";e.on("mousedown",c),document.addEventListener("mousedown",c)}function de(e,r,i={}){const n=e.getContainer(),t=L.latLngBounds(M);["dragenter","dragover","dragleave","drop"].forEach(o=>{n.addEventListener(o,c=>c.preventDefault(),!1)}),n.addEventListener("drop",o=>{if(o.preventDefault(),!!o.dataTransfer.files.length)for(const c of o.dataTransfer.files){if(!c.name.toLowerCase().endsWith(".gpx"))continue;const p=new FileReader;p.onload=d=>{const l=d.target.result,y=new L.GPX(l,{async:!0,polyline_options:{color:"yellow",weight:20,opacity:.3},gpx_options:{joinTrackSegments:!1},markers:{startIcon:null,endIcon:null}});y.on("loaded",()=>{const m=y.getBounds();if(t.intersects(m)){y.addTo(e);const f=c.name.replace(/\.gpx$/i,"");i[f]=y,r.addOverlay(y,f),e.fitBounds(m)}else alert(`GPX file "${c.name}" is outside the allowed bounds and will not be displayed.`)})},p.readAsText(c)}})}function pe(e,r,i,n){function t(){document.getElementById("map").classList.toggle("hide-overlays")}document.addEventListener("keydown",o=>{const c=document.activeElement;c&&(c.tagName==="INPUT"||c.tagName==="TEXTAREA"||c.isContentEditable)||(o.key.toLowerCase()==="o"?t():o.key==="Delete"&&(localStorage.clear(),location.reload()))})}function ue(e){const r=[];let i=null,n=!1;const t=a=>{const s=a.getZoom();return{color:"#9400D3",weight:Math.max(4,25-(18-s)*2),opacity:.3}},o=L.control({position:"bottomleft"});o.onAdd=function(){const a=L.DomUtil.create("div","leaflet-bar leaflet-control"),s=L.DomUtil.create("a","",a);s.href="#",s.innerHTML="🖊️",s.title="Toggle highlighter",s.style.padding="6px 10px",s.style.fontSize="20px";const g=L.DomUtil.create("a","",a);g.href="#",g.innerHTML="🧽",g.title="Clear highlights",g.style.padding="6px 10px",g.style.fontSize="20px",s.onclick=w=>{w.preventDefault(),n=!n,x()},g.onclick=w=>{w.preventDefault(),r.forEach(O=>e.removeLayer(O)),r.length=0,b()},L.DomEvent.disableClickPropagation(a),L.DomEvent.disableScrollPropagation(a);function x(){n?(s.style.background="#ff0",s.style.color="black"):(s.style.background="white",s.style.color="")}return a},o.addTo(e);function c(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function p(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function d(a){return a.latlng?a.latlng:a.touches&&a.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(a.touches[0])):null}function l(a){if(!n)return;const s=d(a);s&&(c(),i=L.polyline([s],t(e)).addTo(e),r.push(i),a.preventDefault&&a.preventDefault())}function y(a){if(!n||!i)return;const s=d(a);s&&(i.addLatLng(s),a.preventDefault&&a.preventDefault())}function m(a){n&&i&&(i=null,n=!1,u(),b(),p()),a.preventDefault&&a.preventDefault()}e.on("mousedown",l),e.on("mousemove",y),e.on("mouseup",m);const f=e.getContainer();f.addEventListener("touchstart",l,{passive:!0}),f.addEventListener("touchmove",y,{passive:!0}),f.addEventListener("touchend",m,{passive:!0}),e.on("zoomend",()=>{r.forEach(a=>a.setStyle(t(e)))}),window.addEventListener("keydown",a=>{if(a.key.toLowerCase()==="d"&&(n=!n,u()),(a.ctrlKey||a.metaKey)&&a.key.toLowerCase()==="z"&&r.length>0){const s=r.pop();e.removeLayer(s),b()}});function u(){const a=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');a&&(n?(a.style.background="#ff0",a.style.color="black"):(a.style.background="white",a.style.color=""))}function b(){if(!r.length){h(null);return}const a=r.map(s=>polyline.encode(s.getLatLngs().map(g=>[g.lat,g.lng]))).join(";");h(a)}function h(a){const s=new URLSearchParams(window.location.search);a?s.set("data",a):s.delete("data");const g=window.location.pathname+(s.toString()?"?"+s.toString():"")+window.location.hash;window.history.replaceState(null,"",g)}function A(){const s=new URLSearchParams(window.location.search).get("data");if(!s)return;s.split(";").forEach(x=>{try{const w=polyline.decode(x).map(([B,G])=>L.latLng(B,G)),O=L.polyline(w,t(e)).addTo(e);r.push(O)}catch{console.warn("Invalid polyline segment:",x)}})}A()}C()&&(document.title="🤖"+document.title);const{map:S,baseLayers:_,overlays:$,currentBaseLayer:me,overlaysControl:ye}=ne();le(S);ce(S,_,me);pe(S,$,_["Google Satellite"]);ue(S);de(S,ye,$);window.addEventListener("load",z);document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&z()});
