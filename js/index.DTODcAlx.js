(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const p of n.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function o(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=o(t);fetch(t.href,n)}})();function I(){return location.protocol.startsWith("file")}const D="UmlkZVNhZmUyMDI1IQ==",$="rident_auth",F=30*24*60*60*1e3;function V(){const e=localStorage.getItem($);if(!e)return!1;try{const{password:r,expires:o}=JSON.parse(e);return r===D&&Date.now()<o}catch{return!1}}function H(){const e=Date.now()+F;localStorage.setItem($,JSON.stringify({password:D,expires:e}))}function M(){if(!V()){if(prompt("Enter password to view the map:")!==atob(D))throw alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>",new Error("Unauthorized");H()}document.body.classList.remove("locked")}const O={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:103},_=[[O.minLat,O.minLon],[O.maxLat,O.maxLon]],v={fast:"rgba(0, 140, 60, 1)",moderate:"rgba(255, 179, 0, 1)",slow:"rgba(255, 40, 40, 1)",veryTechnical:"rgba(128, 0, 128, 1)",maybe:"rgba(180, 180, 180, 1)",likely:"rgba(100, 100, 100, 1)",paved:"rgba(51, 102, 255, 1)"},K=1752506058100,B=L.tileLayer(`https://julcnx.github.io/tiles/heatmap/ride/{z}/{x}/{y}.png?ts=${K}`,{tileSize:256,minNativeZoom:10,maxNativeZoom:13,zIndex:3}),C={satellite:"s",terrain:"p",hybrid:"h",maps:"m"},j=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${C.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),Y=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${C.maps}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),q=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${C.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),J=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${C.hybrid}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,transparent:!0,zIndex:2}),X=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:18}),Q=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17}),ee=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17}),te=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"]}),oe=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxNativeZoom:18}),ne=L.tileLayer("./50k/{z}/{x}/{y}.png",{attribution:"50K",minNativeZoom:13,maxNativeZoom:14}),ae=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],maxNativeZoom:13,maxZoom:20,zIndex:1,className:"overlay"}),se=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10})}}),re=L.tileLayer("https://karta-gateway.geo.azure.myteksi.net/view/api/2.0/sequence/tiles/{x}/{y}/{z}.png",{transparent:!0,minNativeZoom:13,maxNativeZoom:20,className:"overlay"}),le=L.tileLayer("https://content-{s}.strava.com/identified/globalheat/all/hot/{z}/{x}/{y}.png?v=19",{subdomains:["a"],maxNativeZoom:15,zIndex:2,className:"overlay"}),ie=L.tileLayer("https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png",{transparent:!0,maxNativeZoom:18,zIndex:2,className:"overlay"}),E={"World Topo Map":oe,"OSM Standard":te,"Google Maps":Y,"Google Terrain":q};I()&&(E["RTS Map"]=ne);const k={"Google Satellite":j,"ESRI Firefly":X,"ESRI Clarity":Q,"ESRI Wayback":ee},h={"OpenStreetMap traces":ie};I()&&(h["Google Street View"]=ae,h["Google Hybrid"]=J,h.Mapillary=se,h.KartaView=re,h["Strava Heatmap"]=le);let b=0;function ce(e,r,o,a){const t=L.control({position:"topleft"});t.onAdd=function(){const n=L.DomUtil.create("div","leaflet-control leaflet-top-center leaflet-control-layers leaflet-control-layers-expanded transparency-toolbar"),p=L.DomUtil.create("select","",n);p.className="transparency-select",Object.keys(a).forEach(y=>{const u=document.createElement("option");u.value=y,u.textContent=y,p.appendChild(u)});const l=localStorage.getItem("rident_satellite"),c=l&&a[l]?l:Object.keys(a)[0];p.value=c;let i=a[c];i.addTo(e),i.setOpacity(b/100),i.setZIndex(1);const d=L.DomUtil.create("input","",n);return d.className="transparency-slider",d.type="range",d.min=0,d.max=100,d.step=1,d.value=b,L.DomEvent.on(d,"input",y=>{b=parseFloat(y.target.value),i&&i.setOpacity(b/100),d.blur()}),L.DomEvent.on(p,"change",y=>{const u=y.target.value;e.hasLayer(i)&&e.removeLayer(i),i=a[u],i.addTo(e),i.setOpacity(b/100),i.setZIndex(1),localStorage.setItem("rident_satellite",u)}),L.DomEvent.disableClickPropagation(n),p.blur(),n},t.addTo(e)}const A="rident_map_view",P="rident_base_layer",G="rident_satellite",R="rident_overlays";function de(){document.getElementById("map").style.display="block";const e=pe();me(e);const r=L.control.layers(E,h,{collapsed:!0,autoZIndex:!1,position:"topright"}).addTo(e),o=ye(e,E,h,k);return ue(e,E,h),{map:e,mainOverlay:B,baseLayers:E,satelliteLayers:k,overlays:h,currentBaseLayer:o,layersControl:r}}function pe(){return L.map("map",{minZoom:9,maxBounds:L.latLngBounds(_),layers:[B],zoomControl:!0,maxZoom:18,attributionControl:!1})}function me(e){const r=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(r){const a=+r[1],t=+r[2],n=+r[3];e.setView([t,n],a);return}const o=localStorage.getItem(A);if(o)try{const{center:a,zoom:t}=JSON.parse(o);e.setView(a,t);return}catch{}e.setView([18.79,98.98],10)}function ye(e,r,o,a){let t;const n=localStorage.getItem(P);n&&r[n]?(r[n].addTo(e),t=r[n]):(r["World Topo Map"].addTo(e),t=r["World Topo Map"]);const p=localStorage.getItem(R);let l=[];try{l=p?JSON.parse(p):[]}catch{}if(l.length)for(const[d,y]of Object.entries(o))l.includes(d)&&y.addTo(e);const c=localStorage.getItem(G);let i;return c&&a[c]?i=a[c]:i=a["Google Satellite"],i&&(i.setOpacity(b/100),i.addTo(e)),t}function ue(e,r,o){e.on("baselayerchange",a=>{const t=Object.entries(r).find(([p,l])=>l===a.layer);t&&(localStorage.setItem(P,t[0]),t[1].setZIndex(0));const n=Object.entries(k).find(([p,l])=>l===a.layer);n&&(localStorage.setItem(G,n[0]),n[1].setZIndex(1),n[1].setOpacity(b/100))}),e.on("overlayadd overlayremove",()=>{const a=Object.entries(o).filter(([t,n])=>e.hasLayer(n)).map(([t])=>t);localStorage.setItem(R,JSON.stringify(a))}),e.on("moveend zoomend",()=>{const a=e.getCenter(),t=e.getZoom(),n=`#${t}/${a.lat.toFixed(6)}/${a.lng.toFixed(6)}`;location.hash=n,localStorage.setItem(A,JSON.stringify({center:a,zoom:t}))})}function ge(e){const r=L.control({position:"bottomright"});r.onAdd=function(){const o=L.DomUtil.create("div","info legend");o.style.position="relative",o.style.transition="all 0.3s ease",o.style.fontSize="14px",o.style.color="#333",o.style.maxWidth="250px";let a=!1;function t(u){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${u};
				vertical-align:middle;
			"></span>`}const n=document.createElement("div");n.style.background="rgba(255, 255, 255, 0.95)",n.style.borderRadius="6px",n.style.padding="8px",n.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",n.style.display="none",n.style.flexDirection="column";const p=document.createElement("div");p.style.display="flex",p.style.justifyContent="space-between",p.style.alignItems="center",p.style.marginBottom="6px";const l=document.createElement("span");l.textContent="RideNT Legend",l.style.fontWeight="bold";const c=document.createElement("a");c.href="#",c.innerHTML="🔽",c.title="Collapse legend",c.style.fontSize="18px",c.style.textDecoration="none",c.style.cursor="pointer",c.style.padding="4px",c.onclick=u=>{u.preventDefault(),a=!1,y()},p.appendChild(l),p.appendChild(c);const i=document.createElement("div");i.innerHTML=`
			${t(v.paved)} Paved<br>
			${t(v.fast)} Fast dirt<br>
			${t(v.moderate)} Moderate dirt<br>
			${t(v.slow)} Slow / Technical<br>
			${t(v.veryTechnical)} Very technical<br>
			${t(v.likely)} Rural roads<br>
			${t(v.maybe)} Uncertain trails<br>
			<br>
			<span class="caption">Speeds are approximate, based on dry GPX tracks with climate & rider factors considered. Accuracy not guaranteed.</span>
		`,n.appendChild(p),n.appendChild(i);const d=document.createElement("a");d.href="#",d.innerHTML="❓",d.title="Show legend",d.style.display="none",d.style.textDecoration="none",d.style.fontSize="20px",d.style.width="36px",d.style.height="36px",d.style.textAlign="center",d.style.lineHeight="36px",d.style.borderRadius="6px",d.style.background="white",d.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",d.style.cursor="pointer",d.onclick=u=>{u.preventDefault(),a=!0,y()};function y(){n.style.display=a?"flex":"none",d.style.display=a?"none":"inline-block"}return y(),o.appendChild(n),o.appendChild(d),o},r.addTo(e)}function Z(e,r=2e3){const o=document.createElement("div");o.innerText=e,o.style.position="fixed",o.style.bottom="20px",o.style.left="50%",o.style.transform="translateX(-50%)",o.style.background="rgba(0,0,0,0.8)",o.style.color="#fff",o.style.padding="8px 12px",o.style.borderRadius="6px",o.style.fontSize="14px",o.style.zIndex=9999,o.style.opacity=0,o.style.transition="opacity 0.3s ease",document.body.appendChild(o),requestAnimationFrame(()=>{o.style.opacity=1}),setTimeout(()=>{o.style.opacity=0,setTimeout(()=>{document.body.removeChild(o)},300)},r)}function fe(e,r,o){const a=document.getElementById("context-menu");function t(l,c){const i=document.createElement("div");i.innerText=l,i.style.padding="4px 8px",i.style.cursor="pointer",i.onmouseenter=()=>i.style.background="#eee",i.onmouseleave=()=>i.style.background="",i.onmousedown=()=>{c(),a.style.display="none"},a.appendChild(i)}function n(){const l=document.createElement("hr");l.style.margin="0",a.appendChild(l)}e.on("contextmenu",function(l){const c=l.latlng.lat.toFixed(6),i=l.latlng.lng.toFixed(6),d=e.getZoom();a.innerHTML="",t("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/id?#map=${Math.max(16,e.getZoom())}/${c}/${i}`)}),n(),t("Open in Google Maps",()=>{const y=o===r["Google Satellite"],u=new URLSearchParams({api:1,map_action:"map",basemap:y?"satellite":"terrain",center:[c,i].join(","),zoom:d});window.open(`https://www.google.com/maps/@?${unescape(u)}`)}),t("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${c},${i}`)}),t("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${c},${i},${d}z?sport=mtb`)}),I()&&t("Open in Mapillary",()=>{const y=new URLSearchParams({lat:c,lng:i,z:d});window.open(`https://www.mapillary.com/app/?${unescape(y)}`)}),n(),t("Copy Coordinates",()=>{navigator.clipboard.writeText(`${c}, ${i}`).then(()=>{Z("Coordinates copied to clipboard.")})}),t("Copy Bounding Box",()=>{const y=e.getBounds(),u=y.getSouth().toFixed(6),w=y.getEast().toFixed(6),T=y.getNorth().toFixed(6),N=y.getWest().toFixed(6),s=`${T},${N},${u},${w}`;navigator.clipboard.writeText(s).then(()=>{Z("Bounding box copied to clipboard.")})}),a.style.left=l.originalEvent.pageX+"px",a.style.top=l.originalEvent.pageY+"px",a.style.display="block"});const p=()=>a.style.display="none";e.on("mousedown",p),document.addEventListener("mousedown",p)}function he(e,r,o={}){const a=e.getContainer(),t=L.latLngBounds(_);["dragenter","dragover","dragleave","drop"].forEach(n=>{a.addEventListener(n,p=>p.preventDefault(),!1)}),a.addEventListener("drop",n=>{if(n.preventDefault(),!!n.dataTransfer.files.length)for(const p of n.dataTransfer.files){if(!p.name.toLowerCase().endsWith(".gpx"))continue;const l=new FileReader;l.onload=c=>{const i=c.target.result,d=new L.GPX(i,{async:!0,polyline_options:{color:"#9400D3",weight:5,opacity:.7},gpx_options:{joinTrackSegments:!1},markers:{startIcon:null,endIcon:null}});d.on("loaded",()=>{const y=d.getBounds();if(t.intersects(y)){d.addTo(e);const u=p.name.replace(/\.gpx$/i,"");o[u]=d,r.addOverlay(d,u),e.fitBounds(y)}else alert(`GPX file "${p.name}" is outside the allowed bounds and will not be displayed.`)})},l.readAsText(p)}})}function ve(e,r,o,a,t){function n(l=!1){const c=document.getElementById("map");c.classList.contains("hide-overlays")?(c.classList.remove("hide-overlays"),r.setOpacity(1)):(c.classList.toggle("hide-overlays"),r.setOpacity(l?0:1))}function p(){const l=document.querySelector(".transparency-slider");if(!l)return;const c=parseInt(l.value,10);l.value=c===100?"0":"100",l.dispatchEvent(new Event("input",{bubbles:!0}))}document.addEventListener("keydown",l=>{const c=document.activeElement;c&&(c.tagName==="INPUT"||c.tagName==="TEXTAREA"||c.isContentEditable)||(l.key.toLowerCase()==="a"?n(!0):l.key.toLowerCase()==="q"?n(!1):l.key.toLowerCase()==="s"?p():l.key==="Delete"&&(localStorage.clear(),location.reload()))})}const f=[];function be(e){let r=null,o=!1;const a=s=>{const m=s.getZoom();return{color:"yellow",weight:Math.max(4,25-(18-m)*2),opacity:.3}},t=L.control({position:"bottomleft"});t.onAdd=function(){const s=L.DomUtil.create("div","leaflet-bar leaflet-control"),m=L.DomUtil.create("a","",s);m.href="#",m.innerHTML="🖊️",m.title="Toggle highlighter",m.style.padding="6px 10px",m.style.fontSize="20px";const g=L.DomUtil.create("a","",s);g.href="#",g.innerHTML="🧽",g.title="Clear highlights",g.style.padding="6px 10px",g.style.fontSize="20px",m.onclick=x=>{x.preventDefault(),o=!o,S()},g.onclick=x=>{x.preventDefault(),f.forEach(z=>e.removeLayer(z)),f.length=0,w()},L.DomEvent.disableClickPropagation(s),L.DomEvent.disableScrollPropagation(s);function S(){o?(m.style.background="#ff0",m.style.color="black"):(m.style.background="white",m.style.color="")}return s},t.addTo(e);function n(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function p(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function l(s){return s.latlng?s.latlng:s.touches&&s.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(s.touches[0])):null}function c(s){if(!o)return;const m=l(s);m&&(n(),r=L.polyline([m],a(e)).addTo(e),f.push(r),s.preventDefault&&s.preventDefault())}function i(s){if(!o||!r)return;const m=l(s);m&&(r.addLatLng(m),s.preventDefault&&s.preventDefault())}function d(s){o&&r&&(r=null,o=!1,u(),w(),p()),s.preventDefault&&s.preventDefault()}e.on("mousedown",c),e.on("mousemove",i),e.on("mouseup",d);const y=e.getContainer();y.addEventListener("touchstart",c,{passive:!0}),y.addEventListener("touchmove",i,{passive:!0}),y.addEventListener("touchend",d,{passive:!0}),e.on("zoomend",()=>{f.forEach(s=>s.setStyle(a(e)))}),window.addEventListener("keydown",s=>{if(s.key.toLowerCase()==="d"&&(o=!o,u()),(s.ctrlKey||s.metaKey)&&s.key.toLowerCase()==="z"&&f.length>0){const m=f.pop();e.removeLayer(m),w()}});function u(){const s=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');s&&(o?(s.style.background="#ff0",s.style.color="black"):(s.style.background="white",s.style.color=""))}function w(){if(!f.length){T(null);return}const s=f.map(m=>polyline.encode(m.getLatLngs().map(g=>[g.lat,g.lng]))).join(";");T(s)}function T(s){const m=new URLSearchParams(window.location.search);s?m.set("data",s):m.delete("data");const g=window.location.pathname+(m.toString()?"?"+m.toString():"")+window.location.hash;window.history.replaceState(null,"",g)}function N(){const m=new URLSearchParams(window.location.search).get("data");if(!m)return;m.split(";").forEach(S=>{try{const x=polyline.decode(S).map(([U,W])=>L.latLng(U,W)),z=L.polyline(x,a(e)).addTo(e);f.push(z)}catch{console.warn("Invalid polyline segment:",S)}})}N()}document.addEventListener("DOMContentLoaded",()=>{I()&&(document.title="🤖"+document.title);const{map:e,mainOverlay:r,baseLayers:o,satelliteLayers:a,overlays:t,currentBaseLayer:n,layersControl:p}=de();ge(e),fe(e,o,n),ve(e,r,t,o["Google Satellite"]),be(e),he(e,p,t),ce(e,r,t,a),window.addEventListener("load",M),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&M()})});
