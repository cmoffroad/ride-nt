(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const A=location.protocol.startsWith("file"),B={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:103},V=[[B.minLat,B.minLon],[B.maxLat,B.maxLon]],R={fast:"rgba(0, 140, 60, 1)",moderate:"rgba(255, 179, 0, 1)",slow:"rgba(255, 40, 40, 1)",veryTechnical:"rgba(128, 0, 128, 1)",maybe:"rgba(180, 180, 180, 1)",likely:"rgba(100, 100, 100, 1)",paved:"rgba(51, 102, 255, 1)"},P=[{max:7,color:"rgba(128, 0, 128, 1)"},{max:15,color:"rgba(255, 40, 40, 1)"},{max:30,color:"rgba(255, 179, 0, 1)"},{max:null,color:"rgba(0, 140, 60, 1)"}],K=1752761962239,Y=10,X=13,W="UmlkZVNhZmUyMDI1IQ==",J="rident_auth",ne=30*24*60*60*1e3;function ae(){const e=localStorage.getItem(J);if(!e)return!1;try{const{password:n,expires:t}=JSON.parse(e);return n===W&&Date.now()<t}catch{return!1}}function re(){const e=Date.now()+ne;localStorage.setItem(J,JSON.stringify({password:W,expires:e}))}function j(){ae()||(prompt("Enter password to view the map:")!==atob(W)?(alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>"):re()),document.body.classList.remove("locked")}const O=L.tileLayer(`https://julcnx.github.io/tiles/heatmap/ride/{z}/{x}/{y}.png?ts=${K}`,{tileSize:256,minNativeZoom:Y,maxNativeZoom:X,zIndex:3,attribution:"Ride NT",id:"ride-nt"}),U=L.tileLayer(`../../tiles/heatmap/ride/{z}/{x}/{y}.png?ts=${K}`,{tileSize:256,minNativeZoom:Y,maxNativeZoom:X,zIndex:2,attribution:"Ride NT (Dev)",id:"ride-nt-dev"});function G(e,n){return L.tileLayer.wms("https://gisportal.drr.go.th/portal/sharing/servers/aa5fdea8d96542d49d3d8731d77458b7/rest/services/GISBaseMaps/DRR_Dynamic/MapServer/export",{transparent:!0,attribution:e,format:"png",layers:n,bboxSR:102100,f:"image",className:"overlay"})}const se={all:G("DRR (All)","show:1,2,3,4,5,6,7"),highways:G("DRR (Highways)","show:-1,-1,-1,3"),majorHighways:G("DRR (Highways Major)","show:-1,-1,-1,2"),ruralRoads:G("DRR (Rural Roads)","show:-1,-1,-1,7")},_={satellite:"s",terrain:"p",hybrid:"h",maps:"m"},ie=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${_.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,attribution:"Google Satellite",id:"google-satellite"}),le=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${_.maps}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,attribution:"Google Maps",id:"google-maps"}),ce=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${_.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,attribution:"Google Terrain",id:"google-terrain"}),de=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${_.hybrid}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,transparent:!0,zIndex:2,attribution:"Google Hybrid",id:"google-hybrid"}),pe=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:18,attribution:"ESRI Firefly",id:"esri-firefly"}),ue=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17,attribution:"ESRI Clarity",id:"esri-clarity"}),ye=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17,attribution:"ESRI Wayback",id:"esri-wayback"}),me=L.tileLayer("https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=6e5478c8a4f54c779f85573c0e399391",{attribution:"Thunderforest Transport",maxNativeZoom:18,subdomains:"abc"}),ge=L.tileLayer("https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=6e5478c8a4f54c779f85573c0e399391",{attribution:"Thunderforest Transport",maxNativeZoom:18,subdomains:"abc",id:"thunderforest-cyclemap"}),fe=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"],attribution:"OSM Contributors",id:"openstreetmap"}),he=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"WorldTopoMap",maxNativeZoom:18,id:"worldtopomap"}),be=L.tileLayer("../../tiles/50k/{z}/{x}/{y}.png",{attribution:"50K",minNativeZoom:13,maxNativeZoom:14,id:"50k"}),ve=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],maxNativeZoom:13,maxZoom:20,zIndex:1,className:"overlay",attribution:"Google Street View"}),xe=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",attribution:"Mapillary",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10})}}),Le=L.tileLayer("https://karta-gateway.geo.azure.myteksi.net/view/api/2.0/sequence/tiles/{x}/{y}/{z}.png",{transparent:!0,minNativeZoom:13,maxNativeZoom:20,className:"overlay",attribution:"KartaView"}),we=L.tileLayer("https://content-{s}.strava.com/identified/globalheat/all/hot/{z}/{x}/{y}.png?v=19",{subdomains:["a"],minNativeZoom:11,maxNativeZoom:14,zIndex:2,className:"overlay",attribution:"Strava Heatmap All"}),Se=L.tileLayer("https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png",{transparent:!0,maxNativeZoom:18,zIndex:3,className:"overlay",attribution:"OSM GPS Traces"}),I={"World Topo Map":he,"OSM Standard":fe,"Google Maps":le,"Google Terrain":ce,"Transport Map":me,"Cycle Map":ge};A&&(I["RTS Map"]=be);const N={"Google Satellite":ie,"ESRI Firefly":pe,"ESRI Clarity":ue,"ESRI Wayback":ye},M={"OpenStreetMap traces":Se};A&&(M["Google Street View"]=ve,M["Google Hybrid"]=de,M.Mapillary=xe,M.KartaView=Le,M["Strava Heatmap"]=we,M["DRR (All)"]=se.all);let z=0;function Ee(e){const n=L.control({position:"topleft"});n.onAdd=function(){const t=L.DomUtil.create("div","leaflet-control leaflet-top-center leaflet-control-layers leaflet-control-layers-expanded transparency-toolbar"),a=L.DomUtil.create("select","",t);a.className="transparency-select",Object.keys(N).forEach(l=>{const g=document.createElement("option");g.value=l,g.textContent=l,a.appendChild(g)});const o=localStorage.getItem("rident_satellite"),r=o&&N[o]?o:Object.keys(N)[0];a.value=r;let s=N[r];s.addTo(e),s.setOpacity(z/100),s.setZIndex(1);const c=L.DomUtil.create("input","",t);return c.className="transparency-slider",c.type="range",c.min=0,c.max=100,c.step=1,c.value=z,L.DomEvent.on(c,"input",l=>{z=parseFloat(l.target.value),s&&s.setOpacity(z/100),c.blur()}),L.DomEvent.on(a,"change",l=>{const g=l.target.value;e.hasLayer(s)&&e.removeLayer(s),s=N[g],s.addTo(e),s.setOpacity(z/100),s.setZIndex(1),localStorage.setItem("rident_satellite",g)}),L.DomEvent.disableClickPropagation(t),a.blur(),t},n.addTo(e)}const Q="rident_map_view",ee="rident_base_layer",te="rident_satellite",oe="rident_overlays";function Te(){document.getElementById("map").style.display="block";const e=ke();De(e);const n=L.control.layers(I,M,{collapsed:!0,autoZIndex:!1,position:"topright"}).addTo(e);return Ce(e),Me(e),{map:e,layersControl:n}}function ke(){const e=L.map("map",{minZoom:9,maxBounds:L.latLngBounds(V),layers:[O],zoomControl:!0,maxZoom:18,attributionControl:!0});return e.attributionControl.setPrefix(""),e}function De(e){const n=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(n){const a=+n[1],o=+n[2],r=+n[3];e.setView([o,r],a);return}const t=localStorage.getItem(Q);if(t)try{const{center:a,zoom:o}=JSON.parse(t);e.setView(a,o);return}catch{}e.setView([18.79,98.98],10)}function Ce(e){let n;const t=localStorage.getItem(ee);t&&I[t]?(I[t].addTo(e),n=I[t]):(I["World Topo Map"].addTo(e),n=I["World Topo Map"]);const a=localStorage.getItem(oe);let o=[];try{o=a?JSON.parse(a):[]}catch{}if(o.length)for(const[c,l]of Object.entries(M))o.includes(c)&&l.addTo(e);const r=localStorage.getItem(te);let s;return r&&N[r]?s=N[r]:s=N["Google Satellite"],s&&(s.setOpacity(z/100),s.addTo(e)),{currentBaseLayer:n,currentSatelliteLayer:s}}function Me(e){e.on("baselayerchange",n=>{const t=Object.entries(I).find(([o,r])=>r===n.layer);t&&(localStorage.setItem(ee,t[0]),t[1].setZIndex(0));const a=Object.entries(N).find(([o,r])=>r===n.layer);a&&(localStorage.setItem(te,a[0]),a[1].setZIndex(1),a[1].setOpacity(z/100))}),e.on("overlayadd overlayremove",()=>{const n=Object.entries(M).filter(([t,a])=>e.hasLayer(a)).map(([t])=>t);localStorage.setItem(oe,JSON.stringify(n))}),e.on("moveend zoomend",()=>{const n=e.getCenter(),t=e.getZoom(),a=`#${t}/${n.lat.toFixed(6)}/${n.lng.toFixed(6)}`;location.hash=a,localStorage.setItem(Q,JSON.stringify({center:n,zoom:t}))})}function Ne(e){const n=L.control({position:"bottomright"});n.onAdd=function(){const t=L.DomUtil.create("div","info legend");t.style.position="relative",t.style.transition="all 0.3s ease",t.style.fontSize="14px",t.style.color="#333",t.style.maxWidth="250px";let a=!1;function o(d){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${d};
				vertical-align:middle;
			"></span>`}const r=document.createElement("div");r.style.background="rgba(255, 255, 255, 0.95)",r.style.borderRadius="6px",r.style.padding="8px",r.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",r.style.display="none",r.style.flexDirection="column";const s=document.createElement("div");s.style.display="flex",s.style.justifyContent="space-between",s.style.alignItems="center",s.style.marginBottom="6px";const c=document.createElement("span");c.textContent="RideNT Legend",c.style.fontWeight="bold";const l=document.createElement("a");l.href="#",l.innerHTML="🔽",l.title="Collapse legend",l.style.fontSize="18px",l.style.textDecoration="none",l.style.cursor="pointer",l.style.padding="4px",l.onclick=d=>{d.preventDefault(),a=!1,b()},s.appendChild(c),s.appendChild(l);const g=document.createElement("div");g.innerHTML=`
			${o(R.paved)} Paved<br>
			${o(R.fast)} Fast dirt<br>
			${o(R.moderate)} Moderate dirt<br>
			${o(R.slow)} Slow / Technical<br>
			${o(R.veryTechnical)} Very technical<br>
			${o(R.likely)} Rural roads<br>
			${o(R.maybe)} Uncertain trails<br>
			<br>
			<span class="caption">Speeds are approximate, based on dry GPX tracks with climate & rider factors considered. Accuracy not guaranteed.</span>
		`,r.appendChild(s),r.appendChild(g);const p=document.createElement("a");p.href="#",p.innerHTML="❓",p.title="Show legend",p.style.display="none",p.style.textDecoration="none",p.style.fontSize="20px",p.style.width="36px",p.style.height="36px",p.style.textAlign="center",p.style.lineHeight="36px",p.style.borderRadius="6px",p.style.background="white",p.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",p.style.cursor="pointer",p.onclick=d=>{d.preventDefault(),a=!0,b()};function b(){r.style.display=a?"flex":"none",p.style.display=a?"none":"inline-block"}return b(),t.appendChild(r),t.appendChild(p),t},n.addTo(e)}function q(e,n=2e3){const t=document.createElement("div");t.innerText=e,t.style.position="fixed",t.style.bottom="50px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="rgba(0,0,0,0.8)",t.style.color="#fff",t.style.padding="8px 12px",t.style.borderRadius="6px",t.style.fontSize="14px",t.style.zIndex=9999,t.style.opacity=0,t.style.transition="opacity 0.3s ease",document.body.appendChild(t),requestAnimationFrame(()=>{t.style.opacity=1}),setTimeout(()=>{t.style.opacity=0,setTimeout(()=>{document.body.removeChild(t)},300)},n)}function Oe(e,n){const t=document.getElementById("context-menu");function a(s,c){const l=document.createElement("div");l.innerText=s,l.style.padding="4px 8px",l.style.cursor="pointer",l.onmouseenter=()=>l.style.background="#eee",l.onmouseleave=()=>l.style.background="",l.onmousedown=()=>{c(),t.style.display="none"},t.appendChild(l)}function o(){const s=document.createElement("hr");s.style.margin="0",t.appendChild(s)}e.on("contextmenu",function(s){const c=s.latlng.lat.toFixed(6),l=s.latlng.lng.toFixed(6),g=e.getZoom(),p=Object.values(I).find(d=>e.hasLayer(d)),b=Object.values(N).find(d=>e.hasLayer(d));t.innerHTML="",a("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/id?#map=${Math.max(16,e.getZoom())}/${c}/${l}`)}),o(),a("Open in Google Maps",()=>{const d=new URLSearchParams({api:1,map_action:"map",basemap:"terrain",center:[c,l].join(","),zoom:g});window.open(`https://www.google.com/maps/@?${unescape(d)}`)}),A&&(a("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${c},${l}`)}),a("Open in Mapillary",()=>{const d=new URLSearchParams({lat:c,lng:l,z:g});window.open(`https://www.mapillary.com/app/?${unescape(d)}`)})),a("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${c},${l},${g}z?sport=mtb`)}),o(),a("Search here",()=>{n(`${c}, ${l}`)}),a("Copy Coordinates",()=>{navigator.clipboard.writeText(`${c}, ${l}`).then(()=>{q("Coordinates copied to clipboard.")})}),a("Get Elevation",()=>{fetch(`https://api.open-elevation.com/api/v1/lookup?locations=${c},${l}`).then(d=>d.json()).then(d=>{if(d.results&&d.results.length>0){const m=d.results[0].elevation;q(`Elevation: ${m} meters`)}}).catch(d=>console.error("Error fetching elevation:",d))}),A&&(o(),a("Download OSM GPS traces",()=>{window.open("https://api.openstreetmap.org/api/0.6/trackpoints?bbox="+[e.getBounds().getWest(),e.getBounds().getSouth(),e.getBounds().getEast(),e.getBounds().getNorth()].join(",")+"&page=0")}),a("Generate SqliteDB",()=>{const d=e.getBounds(),m=d.getNorth().toFixed(6),f=d.getWest().toFixed(6),y=d.getSouth().toFixed(6),h=d.getEast().toFixed(6),x=`${m},${f},${y},${h}`;let i;(b==null?void 0:b.options.opacity)>0?i=`node scripts/sqlitedb.js ./tmp/${b.options.id}.sqlitedb '${b._url.replace("{s}",b.options.subdomains[0])}' ${x}`:p&&(i=`node scripts/sqlitedb.js ./tmp/${p.options.id}.sqlitedb '${p._url.replace("{s}",p.options.subdomains[0])}' ${x}`),i&&navigator.clipboard.writeText(i).then(()=>{q("Command copied to clipboard.")})})),t.style.left=s.originalEvent.pageX+"px",t.style.top=s.originalEvent.pageY+"px",t.style.display="block"});const r=()=>t.style.display="none";e.on("mousedown",r),document.addEventListener("mousedown",r)}function Ie(e,n,t){const a=e.getContainer(),o=L.latLngBounds(V);["dragenter","dragover","dragleave","drop"].forEach(c=>{a.addEventListener(c,l=>l.preventDefault(),!1)}),a.addEventListener("drop",c=>{if(c.preventDefault(),!!c.dataTransfer.files.length)for(const l of c.dataTransfer.files){if(!l.name.toLowerCase().endsWith(".gpx"))continue;const g=new FileReader;g.onload=p=>{const b=p.target.result;if(t(b))return;const d=r(b);if(d){const m=L.geoJSON(d,{style:y=>({color:y.properties.stroke,opacity:y.properties["stroke-opacity"],weight:y.properties["stroke-width"]}),onEachFeature:function(y,h){h.bindTooltip(`<b>Speed:</b> ${y.properties.speed} km/h<br><b>Time:</b> ${y.properties.time}`)}}).addTo(e);s(e,m);const f=m.getBounds();if(o.intersects(f)){e.fitBounds(f);const y=l.name.replace(/\.gpx$/i,"");M[y]=m,n.addOverlay(m,y)}else alert(`GPX file "${l.name}" is outside the allowed bounds and will not be displayed.`);return}},g.readAsText(l)}});function r(c){const g=new DOMParser().parseFromString(c,"text/xml"),p=g.querySelector("parsererror");if(p)return console.warn("Invalid GPX string:",p.textContent),null;function b(f,y,h,x){const u=(h-f)*Math.PI/180,v=(x-y)*Math.PI/180,S=Math.sin(u/2)**2+Math.cos(f*Math.PI/180)*Math.cos(h*Math.PI/180)*Math.sin(v/2)**2;return 6371*(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)))}const d={type:"FeatureCollection",features:[]};let m=g.querySelectorAll("trkseg");return m.length||(m=g.querySelectorAll("rte")),m.forEach(f=>{let y=f.querySelectorAll("trkpt");y.length||(y=g.querySelectorAll("rtept"));for(let h=1;h<y.length;h++){const x=y[h-1],i=y[h],u=parseFloat(x.getAttribute("lat")),v=parseFloat(x.getAttribute("lon")),S=parseFloat(i.getAttribute("lat")),w=parseFloat(i.getAttribute("lon"));if([u,v,S,w].some(isNaN))continue;let T=null;const k=x.querySelector("time"),D=i.querySelector("time");if(k&&D)try{const C=new Date(k.textContent),H=(new Date(D.textContent)-C)/(1e3*3600);H>0&&(T=b(u,v,S,w)/H)}catch{T=null}const $=(T===null?{color:R.likely}:P.find(C=>T<=C.max)||P[P.length-1]).color,F=[[v,u],[w,S]];d.features.push({type:"Feature",geometry:{type:"LineString",coordinates:F},properties:{baseSpeed:T??null,speed:T?T.toFixed(2):null,time:k?k.textContent:null,stroke:$,"stroke-opacity":.8,"stroke-width":7}})}}),d.features.length>0?d:null}function s(c,l){if(document.getElementById("speed-multiplier"))return;const g=L.control({position:"topright"});g.onAdd=function(d){const m=L.DomUtil.create("div","leaflet-bar");return m.style.background="white",m.style.padding="6px 10px",m.style.fontSize="14px",m.style.lineHeight="1.2",m.style.minWidth="160px",m.innerHTML=`
        <label>
          Speed ÷ <span id="multiplier-val">1.00</span><br/>
          <input id="speed-multiplier" type="range" min="0.1" max="2" step="0.01" value="1" style="width: 140px;" />
        </label>
      `,L.DomEvent.disableClickPropagation(m),m},g.addTo(c);const p=document.getElementById("speed-multiplier"),b=document.getElementById("multiplier-val");p.addEventListener("input",d=>{const m=parseFloat(d.target.value);b.textContent=m.toFixed(2),l.eachLayer(f=>{const y=f.feature.properties.baseSpeed;if(y==null)return;const h=y/m;f.feature.properties.speed=h.toFixed(2);const i=(P.find(u=>h<=u.max)||P[P.length-1]).color;f.setStyle({color:i}),f.setTooltipContent(`<b>Speed:</b> ${h.toFixed(2)} km/h<br><b>Time:</b> ${f.feature.properties.time}`)})})}}function $e(e){function n(){const r=document.getElementById("map");O.options.opacity===1?(O.setOpacity(0),r.classList.remove("hide-overlays")):O.setOpacity(1)}function t(r=!1){const s=document.getElementById("map");s.classList.contains("hide-overlays")?(s.classList.remove("hide-overlays"),O.setOpacity(1)):(s.classList.toggle("hide-overlays"),O.setOpacity(r?0:1))}function a(){const r=document.querySelector(".transparency-slider");if(!r)return;const s=parseInt(r.value,10);r.value=s===100?"0":"100",r.dispatchEvent(new Event("input",{bubbles:!0}))}function o(){A&&(e.hasLayer(O)?(e.removeLayer(O),e.addLayer(U)):e.hasLayer(U)&&(e.removeLayer(U),e.addLayer(O)))}document.addEventListener("keydown",r=>{const s=document.activeElement;s&&(s.tagName==="INPUT"||s.tagName==="TEXTAREA"||s.isContentEditable)||(r.key.toLowerCase()==="a"?t(!0):r.key.toLowerCase()==="q"?t(!1):r.key.toLowerCase()==="w"?n():r.key.toLowerCase()==="s"?a():r.key==="Delete"?(localStorage.clear(),location.reload()):r.key.toLowerCase()==="e"&&o())})}const E=[];function Re(e){let n=null,t=!1,a=!1,o=null;const r=i=>{const u=i.getZoom();return{color:"yellow",weight:Math.max(4,25-(18-u)*2),opacity:.3}},s=L.control({position:"bottomleft"});s.onAdd=function(){const i=L.DomUtil.create("div","leaflet-bar leaflet-control"),u=L.DomUtil.create("a","",i);u.href="#",u.innerHTML="🖊️",u.title="Toggle highlighter",u.style.padding="6px 10px",u.style.fontSize="20px";const v=L.DomUtil.create("a","",i);v.href="#",v.innerHTML="🧽",v.title="Clear highlights",v.style.padding="6px 10px",v.style.fontSize="20px",o=L.DomUtil.create("a","",i),o.href="#",o.innerHTML="⬇️",o.title="Download GPX",o.style.padding="6px 10px",o.style.fontSize="20px",o.classList.add("leaflet-disabled"),o.style.opacity="0.3",o.style.pointerEvents="none",u.onclick=w=>{w.preventDefault(),t=!t,t||(n=null,a=!1),S(),t||l()},v.onclick=w=>{w.preventDefault(),E.forEach(T=>e.removeLayer(T)),E.length=0,n=null,a=!1,y()},o.onclick=w=>{w.preventDefault(),o.classList.contains("leaflet-disabled")||x()},L.DomEvent.disableClickPropagation(i),L.DomEvent.disableScrollPropagation(i);function S(){t?(u.style.background="#ff0",u.style.color="black"):(u.style.background="white",u.style.color="")}return i},s.addTo(e);function c(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function l(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function g(i){return i.latlng?i.latlng:i.touches&&i.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(i.touches[0])):null}function p(i){if(!t)return;const u=g(i);u&&(a||(a=!0,c(),n?n.addLatLng(u):(n=L.polyline([u],r(e)).addTo(e),E.push(n))),i.preventDefault&&i.preventDefault())}function b(i){if(!t||!a||!n)return;const u=g(i);u&&(n.addLatLng(u),i.preventDefault&&i.preventDefault())}function d(i){t&&a&&(a=!1,y(),l()),i.preventDefault&&i.preventDefault()}e.on("mousedown",p),e.on("mousemove",b),e.on("mouseup",d);const m=e.getContainer();m.addEventListener("touchstart",p,{passive:!0}),m.addEventListener("touchmove",b,{passive:!0}),m.addEventListener("touchend",d,{passive:!0}),e.on("zoomend",()=>{E.forEach(i=>i.setStyle(r(e)))}),window.addEventListener("keydown",i=>{if(i.key.toLowerCase()==="d"&&(t=!t,t||(n=null,a=!1),f(),t||l()),(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="z"&&E.length>0){const u=E.pop();e.removeLayer(u),n===u&&(n=null,a=!1),saveToUrl(),y()}});function f(){const i=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');i&&(t?(i.style.background="#ff0",i.style.color="black"):(i.style.background="white",i.style.color=""))}function y(){o&&(E.length?(o.classList.remove("leaflet-disabled"),o.style.opacity="1",o.style.pointerEvents="auto"):(o.classList.add("leaflet-disabled"),o.style.opacity="0.3",o.style.pointerEvents="none"))}function h(i){try{const v=new DOMParser().parseFromString(i,"text/xml"),S=v.querySelector("parsererror");if(S)return console.warn("Invalid GPX string:",S.textContent),!1;const w=v.querySelector("gpx");if(!w||w.getAttribute("creator")!=="MapDrawer")return!1;if(E.forEach(k=>e.removeLayer(k)),E.length=0,n=null,t=!1,v.querySelectorAll("trkseg").forEach(k=>{const D=[];if(k.querySelectorAll("trkpt").forEach($=>{const F=parseFloat($.getAttribute("lat")),C=parseFloat($.getAttribute("lon"));!isNaN(F)&&!isNaN(C)&&D.push(L.latLng(F,C))}),D.length>0){const $=L.polyline(D,r(e)).addTo(e);E.push($)}}),E.length>0){const k=E.flatMap(D=>D.getLatLngs());e.fitBounds(L.latLngBounds(k))}return y(),!0}catch(u){console.warn("Error parsing GPX string:",u)}return!1}function x(){if(!E.length)return;const u=new Date().toISOString(),v=`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="MapDrawer" xmlns="http://www.topografix.com/GPX/1/1">
  <trk>
    <name>Manually Drawn Trace</name>
    <desc>Manually drawn trace for mapping purposes, not GPS-accurate.</desc>`,S="</trk></gpx>",w=E.map($=>`<trkseg>
${$.getLatLngs().map(C=>`<trkpt lat="${C.lat.toFixed(6)}" lon="${C.lng.toFixed(6)}"><time>${u}</time></trkpt>`).join(`
`)}
</trkseg>`).join(`
`),T=`${v}
${w}
${S}`,k=new Blob([T],{type:"application/gpx+xml"}),D=URL.createObjectURL(k),Z=document.createElement("a");Z.href=D,Z.download="drawing.gpx",Z.click(),URL.revokeObjectURL(D)}return{loadDrawingFromGpx:h}}function ze(e){const n=L.DomUtil.create("div","leaflet-bottom-center leaflet-bar leaflet-control");n.style.backgroundColor="white",n.style.padding="4px",n.style.borderRadius="4px",n.style.minWidth="250px",n.style.display="flex",n.style.gap="4px",n.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",n.style.alignItems="center";const t=L.DomUtil.create("input","",n);t.type="text",t.placeholder="Enter lat, lon",t.style.flex="1",t.style.border="none",t.style.outline="none",t.style.padding="4px";const a=L.DomUtil.create("button","",n);a.textContent="Go",a.style.cursor="pointer",a.style.padding="4px 8px",a.disabled=!0;const o=L.DomUtil.create("button","",n);o.textContent="×",o.style.cursor="pointer",o.style.padding="4px 8px",o.style.display="none";const r=L.Control.extend({onAdd:function(){return n},onRemove:function(){}});new r({position:"bottomleft"}).addTo(e),L.DomEvent.disableClickPropagation(n),L.DomEvent.disableScrollPropagation(n);let c;function l(f,y){const h=new URL(window.location.href);h.searchParams.set("coord",`${f},${y}`),h.hash=window.location.hash,window.history.replaceState({},"",h)}function g(){const f=new URL(window.location.href);f.searchParams.delete("coord"),f.hash=window.location.hash,window.history.replaceState({},"",f)}function p(f){t.value=m,a.disabled=!1;const y=f.split(",").map(u=>u.trim());if(y.length!==2){alert('Please enter coordinates as "lat, lon"');return}const h=parseFloat(y[0]),x=parseFloat(y[1]);if(isNaN(h)||isNaN(x)){alert("Invalid latitude or longitude");return}if(h<-90||h>90||x<-180||x>180){alert("Coordinates out of range");return}const i=[h,x];e.setView(i,15),c?c.setLatLng(i):c=L.marker(i).addTo(e),l(h,x),o.style.display=""}function b(){t.value="",a.disabled=!0,o.style.display="none",c&&(e.removeLayer(c),c=null),g()}a.addEventListener("click",()=>p(t.value)),o.addEventListener("click",b),t.addEventListener("input",()=>{const f=/^\s*-?\d+(\.\d+)?\s*,\s*-?\d+(\.\d+)?\s*$/.test(t.value.trim());a.disabled=!f}),t.addEventListener("keydown",f=>{f.key==="Enter"&&!a.disabled&&p(t.value)});const m=new URLSearchParams(window.location.search).get("coord");return m&&p(m),n.appendChild(o),{goToCoords:p}}document.addEventListener("DOMContentLoaded",()=>{A&&(document.title="🤖"+document.title);const{map:e,layersControl:n}=Te();Ne(e),$e(e);const{goToCoords:t}=ze(e),{loadDrawingFromGpx:a}=Re(e);Oe(e,t),Ie(e,n,a),Ee(e),window.addEventListener("load",j),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&j()})});
//# sourceMappingURL=index.CkN3ZCNR.js.map
